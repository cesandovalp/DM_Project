logic method comput scienc submit dec publish dec datalog rewrit regular path queri view nadim franci luc segoufin cristina sirangelo cachan inria mail address franci inria cachan mail address lsv cachan inria cnrs mail address cristina pari abstract consid queri answer view graph databas databas structur edg label graph consid view queri regular path queri rpq queri select pair node graph databas connect path sequenc edg label belong regular languag view determin queri graph databas view imag answer well defin function main result function monoton exist rewrit datalog queri view instanc rewrit queri evalu time polynomi size impli decid rpq queri rewritten datalog rpq view introduct consid problem answer queri view graph databas graph databas relat databas relat symbol binari graph databas view edg label direct graph graph structur data scenario typic exampl semant web format rdf social network graph structur data differ conceptu relat databas topolog under graph data usual queri will test node connect connect context set queri answer queri typic exampl data integr set data sourc describ view virtual global databas queri global databas acm ccs system data manag system queri languag databas manag system engin databas queri process key phrase regular path queri view rewrit datalog logic method comput scienc doi lmcs franci segoufin sirangelo creativ common franci segoufin sirangelo rewritten queri view exampl cach answer set queri data sourc cach wish newli arriv queri answer cach access sourc problem find applic context secur privaci suppos access databas provid set public view answer queri secret requir verifi disclos view provid answer secret queri problem phrase term view queri rewrit view typic databas problem specif graph databas receiv consider attent graph databas concern differ lie kind queri consider graph databas typic queri express power regular path queri rpq defin survey rpq select pair node connect path sequenc edg label satisfi regular express view denot finit set rpqs evalu graph databas view yield graph databas edg relat symbol interest know view answer rpq queri comput databas case determin rewrit queri queri languag express term interest find algorithm evalu rewrit algorithm comput question determinaci queri rewrit studi relat databas graph databas relat databas determinaci und cidabl queri view defin union conjunct queri decid status open view queri conjunct queri graph databas rpq queri view decid status determinaci open determinaci decid scenario view queri test path distanc node scenario lie intersect rpq trivial exampl instanc view pair node connect path length determin queri pair node connect path length exampl clear rewritten term rewrit wit termin hand determinaci find rewrit defin languag comput properti natur rewrit languag power determinaci equival exist rewrit defin clear depend languag defin queri view consid case determin rewrit term defin rewrit defin rpq exampl case view queri defin cqs open problem order logic power rewrit languag wors datalog rewrit regular path queri view exist rewrit evalu time polynomi size view instanc polynomi data complex situat aris graph databas rpq view queri check exampl exist monoton rewrit exampl rpqs defin monoton queri rewrit defin rpq monoton queri languag datalog rpq extens crucial databas applic possibl express rewrit languag subject monoton restrict paper consid stronger notion determinaci refer monoton determinaci requir map view instanc queri monoton case view queri defin cqs monoton determinaci equival exist rewrit problem decid monoton determinaci cqs decid consid monoton determinaci graph databas view queri defin rpqs observ monoton determinaci correspond tion call lossless sound view assumpt decid concentr rewrit problem exist case monoton rewrit express rpq exampl power languag order express monoton rewrit hard determin exist rewrit data complex well rewrit conp data complex main result determin monoton exist rewrit defin datalog evalu polynomi time proof construct datalog rewrit comput corollari impli decid queri rewrit defin datalog view defin rpqs fact main result impli exist rewrit datalog equival monoton determinaci decid properti mention work work close italian notion lossless exact view assumpt introduc correspond call determinaci notion lossless sound view assumpt correspond call monoton determinaci monoton determinaci mention thesi strong determinaci correspond exist monoton rewrit lot attent devot problem comput set answer queri set view sound view assumpt precis definit answer rpq view queri problem equival test instanc homomorph emb structur comput view queri general data complex comput answer conp complet build constraint satisfact problem rpq view rpq queri datalog program contain answer sens maxim contain franci segoufin sirangelo datalog program contain answer head variabl variabl rule assum determin monoton easi queri comput answer sound view assumpt rewrit answer view instanc precis queri result rewrit agre instanc form differ instanc imag comput answer conp hard main result exist rewrit express datalog polynomi time data complex proof structur mention datalog rewrit turn queri associ suitabl valu preliminari graph databas path binari schema finit set relat symbol ariti schema paper binari graph databas finit relat structur binari schema will structur altern view direct edg label graph label alphabet element domain refer node number element denot set element denot substructur induc graph databas path finit sequenc node hold simpl path path node occur sequenc label denot word abus notat view path graph databas node edg occur sequenc queri queri languag queri schema map associ graph databas finit relat domain will consid binari queri queri return binari relat work queri languag regular path queri abbrevi rpq regular expr sion alphabet rpq denot languag correspond regular express graph databas queri select pair node exist path instanc queri introduct rpq correspond regular express denot exampl rpq select pair node connect path length context free path queri defin context free grammar regular express conjunct regular path queri abbrevi crpq con junctiv queri atom rpqs instanc queri datalog rewrit regular path queri view select pair node connect path label path label share express rpq datalog queri schema defin finit set rule form relat symbol symbol intern symbol call head rule intern symbol variabl variabl occur understood existenti quantifi intern symbol refer goal binari design output queri evalu datalog queri comput intern relat increment start empti appli greedili rule easi regular context free path queri conjunct regular path queri express datalog datalog express queri languag present well datalog queri evalu polynomi time data complex procedur sketch will consid restrict datalog limit maxim ariti intern sym bol number variabl rule classic context constraint satisfact problem csp will context csp dat alog program boolean goal ariti datalogl denot fragment allow variabl rule intern symbol ariti deal binari datalog program order stay close notat come csp general definit datalogl denot datalog program variabl rule intern symbol ariti ariti goal case view binari schema view set consist binari queri symbol consist queri abus notat denot correspond symbol graph databas denot graph databas binari symbol instanti view consist queri rpq view rpq defin context free path queri view conjunct regular path queri view refer view queri assum schema view view instanc structur databas determinaci rewrit notion determinaci specifi queri swere complet view definit definit determinaci view determin queri depend view instanc databas yield view observ determinaci exist function defin view imag databas call function induc franci segoufin sirangelo rewrit queri schema notic rewrit function induc uniqu fact domain defin set view imag structur exist databas fulli defin ident uniqu contrari rewrit defin queri map defin structur form condit suffici fulli defin arbitrari valu structur form cours rewrit coincid function restrict view imag exampl consid view defin rpqs test exist path length rpq test exist path length turn determin mention verifi rewrit express order queri figur function induc monoton impli monoton queri rewrit exist rpq rewrit consid rpq verifi determin databas consist singl node edg databas consist singl path length empti view disagre figur illustr exampl function induc monoton point understand differ determinaci rewrit determin exist rewrit rewrit agre function induc restrict view imag arbitrari valu structur datalog rewrit regular path queri view imag view consid instanc view queri exampl queri rewrit equival rewrit exampl instanc hold databas path length node distanc path hold rewrit differ instanc view imag instanc consist singl label edg determinaci problem queri languag problem decid input view defin queri determin determinaci exist rewrit defin queri languag comput data complex clear depend languag view queri rewrit problem queri languag problem find rewrit queri view defin determin problem thorough investig case rpq determinaci problem rpq remain wide open clear good low data complex rewrit languag rpq note situat aris case determinaci problem mention determinaci problem rpqs open context free path queri conjunct regular path queri determinaci und cidabl problem undecid queri rpq undecid formal proposit proposit context free path queri view regular path queri undecid determin proof prove reduct univers problem context free languag context free languag alphabet fresh symbol appear defin defin determin univers assum univers easi check rewrit convers assum univers exist consid databas consist simpl path label empti databas node path empti determin proposit conjunct regular path queri view regular path queri undecid determin proof prove reduct word problem graph databas franci segoufin sirangelo problem word problem graph databas input list pair pair view rpqs question statement true graph databas straightforward reduct word problem finit semigroup lemma word problem graph databas undecid proof prove reduct word problem finit semigroup problem input word problem graph databas ask semigroup homomorph case prove input accept word problem finit semigroup accept word problem graph databas assum input accept word problem finit semigroup graph databas comput semigroup homomorph element set pair finit finit element defin easi check oper associ well defin depend specif choic set construct impli assum input accept word problem graph databas finit semigroup homomorph defin graph databas set node set finit subset node edg assum impli impli path input word problem copi fresh symbol denot correspond symbol defin queri view rpq defin copi symbol queri view defin rpq queri view defin rpq copi symbol queri view defin crpq queri view defin crpq prove determin input accept word problem graph databas datalog rewrit regular path queri view assum input accept word problem graph databas graph databas consid case symbol reveal entir impli symbol reveal entir ensur remain consid case symbol symbol notic isomorph renam impli final isomorph impli impli reason convers conclud determin assum determin graph databas satisfi condit word problem copi renam symbol correspond symbol remark fact copi fact satisfi condit word problem final fact resp symbol resp determin impli impli copi yield reason convers conclud input accept word problem graph databas view rewrit previous know view determin queri comput difficult task assum determin investig comput view instanc possibl generic algorithm structur comput structur reject exist return determin procedur return correct answer view imag queri defin algorithm rewrit queri languag consid paper comput time polynomi remain test exist comput issu test instanc imag view challeng task will investig start second problem comput exist franci segoufin sirangelo view preimag assum view structur imag know exist result rpq view exist size polynomi essenti pump argument lemma rpq view structur size quadrat proof letv statement lemma exist exist databas size step normal alter view node occur appear path link node normal turn consist constant number disjoint path pair node constant depend size view automaton ramsey argument path cut chang view databas consist constant number path constant length pair node size formal argument assum exist databas prove lemma construct databas product automaton determinist minim automata regular express rpqs number state denot function send start state arriv state path databas minim element node domain build databas node minim path minim path intersect number minim path bound construct element element function pair element exist minim path add copi fresh repeat node figur illustr main idea construct easi check desir properti second bullet hold construct clear number bound third bullet hold remain check obvious canon homomorph send convers direct consid path wit fact decompos minim path construct minim path simul construct desir replac minim path length bound constant view imag altogeth will size bound polynomi desir datalog rewrit regular path queri view number guarante exist monochromat cliqu cliqu color consid minim path xmami denot pis subpath start posit end posit pis xsasx pair node attribut color fij fij pii pii choic exist fij fjk fik path construct replac subpath pii pij databas construct replac prove properti list repeat oper minim path length eventu desir databas wit path start end intern node intern node appear case wit fact notic fik fjk impli replac wit fact altogeth suppos wit path intern node path conclud fact fik fjk remain consid case end xjaj exist pii pij construct path replac segment xjaj xiai wit fact contradict element altogeth prove view lemma determin exist rewrit ing data complex queri comput determinist polynomi time algorithm input structur guess data base polynomi size check evalu exist rewrit conp data complex consid databas polynomi size altogeth corollari rpqs determin exist rewrit data complex conp data complex rpq view queri determinaci impli exist rewrit polynomi time data complex complex bound corol lari current best bound will section assum function induc monoton exist rewrit defin datalog comput polynomi time franci segoufin sirangelo figur illustr transform lemma node color white black depend appear intric pump argument conjunct regular path queri view fact view instanc imag wit databas polynomi size corollari extend conjunct regular path queri will context free path queri view recurs bound size databas yield view instanc will follow lemma show context free path queri view check view instanc imag view undecid test view imag consid problem view structur exist structur note problem previous view lemma mediat algorithm test membership imag rpq view input guess databas size polynomi check will test view imag hard regular path queri view undecid context free path queri view test view imag ptime determin exist rewrit polynomi time data complex polynomi time algorithm work view instanc test exist databas reject consid schema letter consid queri path languag defin return pair node link pair node expand empti relat singl pair datalog rewrit regular path queri view singl pair node test view imag simpl argument test iff algorithm work time polynomi size mention test view imag hard rpq view lemma rpq view structur hard test exist structur proof reduc color problem proof simpl variat reduct prove comput answer sound view assumpt conp hard data complex abus notat will refer element symbol view connect graph defin structur interpret interpret empti relat color iff exist intuit idea describ color edg color point edg instanc link understood red green check pair node connect color color check error node requir color empti graph databas error color precis assum color exist color function defin structur interpret easi check hold empti convers assum exist graph databas con sider color function defin exist hold empti check uniqu defin proper color regular languag context free problem und cidabl lemma context free path queri view instanc undecid exist structur franci segoufin sirangelo proof prove reduct univers problem context free languag context free languag alphabet fresh symbol appear defin defin final view instanc singl pair pair exist univers assum exist databas exist path exist univers convers assum univers exist easi check databas consist simpl path label satisfi intric argument undecid hold fix view defini tion lemma exist fix context free path queri view structur undecid exist structur proof copi fresh symbol denot correspond symbol word denot word correspond read left consist view reveal symbol view defin addit queri defin equat function map symbol correspond symbol check languag context free languag prove view instanc specif view undecid exist databas prove reduct post correspond problem pcp instanc pcp third argument explicit pair build view instanc datalog rewrit regular path queri view vun vvn xend pcp encod solut encod exist pcp instanc satisfi intuit consist part encod pcp instanc letter reveal view tupl simpli enumer natur order ith tupl encod dash arrow vui vvi repres correct success natur encod unari encod tupl second instanc state exist solut instanc hidden letter state exist solut fact view empti check solut correct assum exist databas exist path xend path form word remark hold impli xend lead contradict remain encod mirror tupl pcp instanc impli solut assum mirror tupl encod half instanc remark exist path label lead contradict case lead exist path label contradict assum exist solut pcp instanc databas consist simpl path uim simpli repres correspond written note proof lemma view instanc code pcp instanc correspond databas code solut recurs bound size solut pcp instanc context free path queri view recurs bound size databas yield view instanc compar polynomi bound rpq view lemma franci segoufin sirangelo monoton determinaci rewrit exampl rpq view rpq queri determin function induc monoton rpq rewrit natur wonder monoton function induc queri limit exist rpq rewrit recal introduct defin cqs determin function induc monoton iff exist rewrit case rpq view queri analog hold will assum monoton rpq rewrit exist will rewrit defin datalog exist start formal notion monoton determinaci definit monoton determinaci view determin queri monoton determin function induc monoton monoton determinaci equival properti turn coincid notion lossless sound view assumpt defin decid expspac complet rpqs corollari monoton determinaci problem rpqs expspac complet note proof proposit rewrit monoton view determin queri context free path queri view rpq queri monoton determinaci undecid recal exampl exist view queri view determin queri monoton assum rpq view rpq queri determin monoton observ case rewrit defin rpq fact defin rpqs decid rpq rewrit exist problem complet test monoton determinaci expspac complet simpl complex argument rpq rewrit guarante exist monoton determinaci concret exampl wit fact exampl defin verifi determin wit rewrit rewrit illustr figur consid databas figur typic databas choic wit exampl claim exampl exampl determin datalog rewrit regular path queri view convers consid databas figur typic databas top path figur databas exampl monoton determin monoton instanc decis procedur provid rpq rewrit exist previous exampl exhibit conjunct regular path queri rewrit ing exampl suggest conjunct regular path queri express rewrit languag exampl defin length modulo length aaa length verifi determin monoton wit rewrit defin queri hold node link path length path length path length fact check simpl case analysi case illustr figur case path length top path length path start bottom segment top segment length simpl induct hold node link path length modulo path length modulo path length modulo assum hold exist distanc hold assum distanc modulo case distanc hold exist path length modulo path length modulo distanc franci segoufin sirangelo path yield path length modulo distanc second path yield path length modulo figur convers easi check hold hold fact hold distanc notic monoton tedious combinatori argument express conjunct regular path queri aaa figur exampl arbitrari databas view satisfi arrow form node node understood path label wit figur three case exampl part shade remark care reader notic exampl rewrit express mso will easili true general defin rpqs determin monoton exist rewrit defin mso univers mso datalog rewrit regular path queri view datalog rewrit prove main result theorem rpqs determin monoton exist datalog rewrit theorem impli monoton determinaci problem rpqs coincid problem exist datalog rewrit decid corollari corollari rpqs decid expspac complet exist datalog rewrit proof construct datalog rewrit comput main idea sketch proof start point relationship rewrit ing answer monoton determinaci easili view determin queri monoton answer queri rewrit ing answer rpq view queri conp hard comput exist rewrit cours coincid answer view imag express datalog rewrit suggest relationship answer constraint satisfact problem csp adopt homomorph point view csps csp fine structur call templat solut structur map homomorph templat rpqs answer express csp templat depend templat exist datalogl queri approxim csp defin templat datalogl approxim comput precis csp associ exact view imag rewrit view determin queri monoton depend datalogl approxim exact view imag prove exist datalog rewrit step exist datalog approxim exact view imag simpl path databas lift result view imag step prove care analysi properti view imag simpl path databas second step exploit monoton provid detail monoton rewrit answer csp view queri structur answer structur defin certq notion refer answer sound view assumpt open assumpt literatur straightforward check determin monoton queri certq rewrit certq structur franci segoufin sirangelo languag express answer suitabl rewrit lan guag monoton determinaci proposit prove rpq view queri answer rewrit express negat csp proposit rpq view rpq queri exist structur set distinguish sourc node set distinguish target node determin monoton equival structur pair node certq homomorph send sourc node target node sequel csp resp csp refer set triplet structur node homomorph resp homomorph send sourc node target node view proposit determin monoton csp iff observ csp natur defin binari queri associ structur set pair node csp abus notat clear context will csp denot binari queri remark structur proposit effect comput observ csp express existenti mso mention remark rpqs determin monoton exist rewrit defin univers mso rewrit effect comput well answer queri rewrit comput conp instanc proposit assum conp ptime certq comput polynomi time assumpt determin monoton exist defin rpqs certq conp hard data complex easi reduct problem lower bound remain valid assum determin monoton proposit exist rpq viewv rpq queri determin monoton conp hard decid structur node certq determin monoton rewrit express datalog comput polynomi time remark conp complex certq extend context free path queri view rpq queri precis prove equival structur assumpt determin monoton defin boolean problem node rpq queri binari paramet present problem csp defin view classic csp problem extend signatur unari predic interpret sourc target node datalog rewrit regular path queri view proposit context free path queri view rpq certq evalu conp data complex proof context free path queri view rpq schema prove certq evalu conp data complex reduc case regular path view determinist minim automaton denot function associ state state reach read start defin languag claim regular languag recal function languag defin regular notic union languag remark construct decid empti case context free defin view defin rpq view view instanc defin copi relat replac view instanc certq certq certq evalu conp size size assum certq exist path databas remark exist path certq convers assum certq exist databas path satisfi build databas start copi pick path label exist add simpl path fresh node label remark path form pin pii path origin path fresh node exist path start node defin path pin certq prove certq proposit consequ corollari rpq context free path queri view determin monoton exist rewrit evalu conp data complex franci segoufin sirangelo notic proof proposit corollari assum languag defin view context free work languag order effect construct rewrit formal defin view decid empti test intersect regular languag exist datalog rewrit rpq queri rpq view determin monoton exist datalog rewrit exist rewrit stem link csps datalog recal proposit determin monoton csp view binari queri rewrit csp problem arbitrari templat associ canon datalogl program program equival describ term player game thought maxim approxim complement csp problem precis sens interest reader refer detail main contribut consist prove explicit valu depend datalogl approxim exact restrict view imag comput precis csp rewrit instanc player game correspond datalog definit player game integ structur node game play player game empti function round defin player select set node player respond homomorph coincid sourc node target node player win point player move player win play forev exist win strategi player express datalog lemma integ rpq queri rpq view exist program datalogl graph databas set pair player win strategi player game program lemma effect construct will simpli denot clear context readi state main technic result paper proposit rpq view rpq queri termin monoton exist rewrit theorem consequ proposit rest devot prove proposit step prove datalog rewrit regular path queri view exist rewrit restrict view imag simpl path graph databas suffic rewrit observ homomorph structur send sourc node target node player win strategi player game strategi consist play restrict homomorph set select player sens program datalogl approxim csp problem csp structur proposi tion impli will refer properti sound convers inclus hold player win strategi exhibit partial homomorph call local consist check general suffici guarante exist suitabl global homomorph interest arbitrari structur structur form simpl path graph databas properti structur local consist check suffici global homomorph suitabl program comput precis csp view simpl path graph databas case simpl path graph databas proposit rpq view rpq queri exist simpl path databas iff csp determin monoton iff proof rpq view rpq queri graph databas consist simpl path node node assum will lemma larg player win strategi game exhibit homomorph wit fact csp prove crucial properti will exploit sequel simpl definit claim consist simpl path product automaton determinist minim automata regular express rpqs number state denot state start state arriv state relat equival relat prove main properti bound size franci segoufin sirangelo claim proof node associ state defin pii pis defin subpath start posit end posit pis xsasx assum exist node imag pii pij prove assum exist pii final remark pii pii pik deduc pii pik pii pik conclud pij final symmetr argument easili prove direct equival final conclud thatn distinct equival class node easili verifi properti equival relat will claim element occur impli readi prove statement proposit prove iff csp view fact encod player game sens lemma prove lemma player win strategi player game iff homomorph send sourc node target node proof left direct obvious suitabl homomorph player win strategi consist play convers assum player win strategi player game order element order occur clear player select element singl round player provid full homomorph conclud proof assum eas notat will number round start technic equival player select empti set round player win strategi win respons play player datalog rewrit regular path queri view round player play player respond partial homomorph win strategi assum round size element biggest case round choic set big claim exist element round player pick choic maintain size element biggest player respond partial homomorph play round element biggest longer care player move arbitrarili set defin observ definit map send sourc node target node game remain prove homomorph prove induct homomorph coincid exist base case map coincid definit follow easili induct case assum exist hold prove definit impli definit yield hold result obvious impli exist claim deduc prove exact element remov round exist element claim impli hold definit preserv loop impli homomorph edg element preserv remark simpl path edg prove edg preserv impli exist element homomorph preserv edg impli coincid preserv edg final definit impli edg preserv edg franci segoufin sirangelo final appli prove homomorph complet proof lemma assum determin monoton proposit imm diat iff complet proof proposit simpl path arbitrari graph databas proposit determin monoton rewrit restrict simpl path databas remain lift result arbitrari graph databas sens result general case reduc simpl path case proposit rpq view rpq queri deter mine monoton assum queri schema close homomorph databas pair element exist homomorph sound complet simpl path databas simpl path databas domain iff sound graph databas element rewrit proof databas pair element ofv exist path consid simpl path xmamxm defin determin monoton domain impli addit clear exist homomorph observ extend view homomorph impli direct element prove proposit rpq view rpq queri determin monoton proposit exist sound complet simpl path databas datalog queri preserv homomorph observ sound proposit exist rewrit prove proposit theorem conclus rpq view determin rpq queri monoton datalog rewrit comput corollari decid exist datalog rewrit rpq queri rpq view extend rpq rpq defin regular express alphabet ask pair node link path symbol travers edg label direct arrow symbol backward datalog rewrit regular path queri view travers edg label queri languag studi extens corollari proposit rpq build extend rpqs detail complic general idea wonder simpler queri languag datalog suffic express monoton rewrit rpq queri rpq view instanc exampl awar transit closur binari conjunct regular path queri natur linear datalog intern predic occur bodi rule intern predic ariti express monoton rewrit leav interest question futur work final conclud mention monoton determinaci problem conjunct regular path queri decid likewis decid rpq view determin rpq queri monoton assumpt open problem refer serg abiteboul oliv duschka complex answer queri materi view acm symp principl databas system pod serg abiteboul richard hull victor vianu foundat databas addison wesley foto afrati determinaci queri rewrit conjunct queri view theoret puter scienc pablo barcelo baeza queri graph databas acm symp principl databas system pod diego calvanes giusepp giacomo maurizio lenzerini mosh vardi answer regular path queri view intl conf data engin icd ieee diego calvanes giusepp giacomo maurizio lenzerini mosh vardi view base queri process constraint satisfact ieee symp logic comput scienc lic ieee diego calvanes giusepp giacomo maurizio lenzerini mosh vardi lossless regular view acm symp principl databas system pod acm diego calvanes giusepp giacomo maurizio lenzerini mosh vardi rewrit regular express regular path queri journal comput system scienc diego calvanes giusepp giacomo maurizio lenzerini mosh vardi view base queri process relationship rewrit answer lossless theoret comput scienc isabel cruz alberto mendelzon peter wood graphic queri languag support recurs sigmod rec decemb toma feder mosh vardi comput structur monoton monad snp constraint satisfact studi datalog group theori siam journal comput alon levi alberto mendelzon yehoshua sagiv divesh srivastava answer queri view acm symp principl databas system pod alan nash luc segoufin victor vianu view queri determinaci rewrit acm transact databas system jorg rez schema map manag data exchang system phd thesi escuela ing nier pontificia universidad cato lica chile work licens creativ common attribut noderiv licens view copi licens visit http licens send letter creativ common second suit san francisco usa eisenach strass berlin germani 