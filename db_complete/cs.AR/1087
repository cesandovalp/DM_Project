fast improv fat tree encod wave union tdc fpga shen zhao lei liu shu bin liao sheng kai bin xiang xue peng cheng zhi key laboratori particl detect electron univers scienc technolog china hefei china modern physic univers scienc technolog china hefei china nation laboratori physic scienc microscal hefei china abstract wave union method achiev best time perform fpga base tdc design guarante structur thermomet code binari code encod process finish system clock cycl implement encod challeng consid high speed requir high resolut wave union tdc demand encod convert ultra wide input code binari code fast improv fat tree encod ift fulfil requir bubbl error suppress integr encod scheme wave union tdc rms effect bin size implement fpga xilinx virtex famili encod time achiev bit thermomet code bit binari code convers conduct seri test oscil period wave union launcher well perform tdc test indic ift work well fact implement encod manual rout special constrain requir ift structur appli delay chain base fpga tdcs key wave union tdc fpga binari encod time interpol pac support knowledg innov program chines academi scienc nation natur scienc foundat china fundament fund central univers mail zlei introduct high resolut time measur high energi physic hep experi time flight tof detector system time digit convert tdc essenti part instanc readout electron larg ion collid experi alic tof detector kernel asic tdc chip name hptdc develop hep applic hptdc electron beij spectromet besiii tof system time resolut achiev good review evolut time digit convert compar asic tdcs fpga base tdcs benefit shorter develop time better flexibl tdcs implement fpgas delay line perform time interpol fpga tdcs final resolut limit cell delay determin fpga manufactur process wave union tdc scheme propos improv effect bin size time precis rms limit base wave union method typic time perform rms effect bin size achiev xilinx virtex fpga previous wave union method requir high speed thermomet code binari code encod ensur tdc function well input hit wave union launcher logic transit will trigger fed tdc delay state delay cell latch rise edg system clock cycl encod process finish clock cycl wave union launcher essenti ring oscil raw bin pattern thermomet code delay time tap delay cell fpga ten picosecond consid clock period number delay cell length thermomet code encod process finish clock cycl challeng implement encod convert ultra wide thermomet code binari code short time period encod filter bubbl error thermomet code caus sourc meta stabil uneven propag delay wave union tdc design period wave union launcher design longer system clock period oscil rise edg clock cycl thermomet code thermomet code simplifi encod process method thermomet code binari code encod refer design encod work implement high speed low power encod asic flash analog digit convert common approach gray binari rom base encod rom base encod simpl straight forward design slow suppress bubbl error wallac tree base encod wallac count number bit thermomet code advantag approach bubbl suppress accompani disadvantag larg delay power consumpt mux base encod propos consist entir multiplex encod complex shorter critic path wallac tree encod larg fan critic path lee propos fat tree encod asic approach benefit high encod speed low power consumpt report encod encod implement fpgas inspir fat tree encod method develop fast improv fat tree encod ift special consider wave union tdc implement xilinx virtex fpga devic pipelin techniqu introduc ift overcom unpredict interconnect delay fpga special structur ift time integr easili satisfi manual placement rout implement ift devic independ easili transplant type fpga ift structur appli delay chain base fpga tdcs outlin paper describ design implement propos ift test present conclus drawn methodolog implement fig diagram entir wave union tdc block diagram entir wave union tdc depict fig wave union launcher embed insid tap delay ift import thermomet code generat regist delay convert binari code binari code written readout fifo output coars counter encod process carri stage ift fig stage convert thermomet code code convert second stage binari code improv fat tree structur fig stage ift thermomet code code convert bit pattern raw bin implement fpga tdc length tap delay ttdl longer system clock period tclk allow tap delay variat temperatur power suppli voltag mention oscil period wave union launcher tosc design exceed ttdl valid oscil edg clk cycl valid edg defin transit left raw bin exampl relationship tosc ttdl tclk tosc ttdl tclk bit pattern raw bin binari code clk hitin encod ift thermomet code coars counter thermomet code code binari code stage convert stage convert fig transit transit transit transit fig bit pattern raw bin function detect transit record posit point view thermomet code part consid thermomet code logic appear output code implement input gate input invert flip flop dffs fig fig thermomet code code convert code calcul transit occur msb code bit equal code will convert binari code maximum correspond length entir tap delay ttdl ttdl exceed fine time rang tclk maximum binari code sens function flag bubbl error suppress bubbl error transit edg occur uneven propag delay nois fpga structur common method detect transit thermomet code input gate input invert input gate suppress bubbl error design bubbl error occur thermomet code will appear code lead catastroph error binari code bit input gate recogn bit pattern bit pattern tosc ttdl tosc ttdl tosc ttdl tosc ttdl edg edg edg edg valid transit bit bubbl case origin bit bubbl case origin elimin circuit bubbl error bit rare occur bit input gate structur transit detect elimin bubbl error problem code binari code convert code pass second stage ift code binari code convert multipl tree gate pipelin regist employ mention fat tree encod asic pipelin regist signal logic delay gate input binari code output uniform guarante manual layout interconnect rout delay fpgas unpredict special care total signal delay fpgas consist logic delay rout delay critic path longer pipelin regist guarante good time margin high speed situat propos ift structur pipelin regist insert fat tree encod logic reduc critic path delay fig exampl ift structur bit binari output case ift structur includ basic tree output bit tree bit code present left node basic tree bit binari code produc node output bit tree basic tree output bit tree fig exampl ift structur bit binari output case basic tree produc intermedi signal code repres bit number code binari code msb lsb relat output bit tree produc binari code pipelin regist insert input gate basic tree output bit tree input gate replac input gate reduc amount regist input gate implement tabl lut virtex fpga benefit ift structur binari output bit process parallel lead shorter encod time exist stage bit code msb bit binari code basic tree uniform latenc binari output bit addit regist stage output bit tree wave union tdc design system clock frequenc mhz clock period correspond tap delay cell raw thermomet code design bit wide length code set satisfi equat high bit code assign constant valu implement ift circuit synthes place rout process automat softwar ise manual placement rout time integr easili satisfi test evalu board readout pci extens instrument pxi bus design test perform propos ift scheme channel wave union tdc implement fpga photograph board fig test present fig pictur evalu board measur oscil period wave union launcher measur oscil period tosc wave union launcher estim perform encod scheme ift period hit signal puls generat free run respect tdc system clock fed tdc channel valid hit signal system clock sampl state delay cell turn turn cycl correspond raw bit record mention exist wave union transit cycl set design tosc calcul repres adjac fine time raw bit output binari code ift tosc direct time interv adjac oscil transit statist analysi tosc perform larg amount test data tosc will follow normal distribut constant ift work well error valu will caus will result error valu tosc statist analysi tosc perform channel thousand data point typic result fig tosc standard deviat error tosc observ indic encod scheme ift perform correct steadili order verifi method tosc measur lecroy oscilloscop wavepro analog bandwidth tie output tap delay chain fpga output test pin fig graph tosc tosc standard deviat concord well test demonstr correct ift encod statist spread tosc deriv ift output code graph tosc measur oscilloscop fig test oscil period tosc wave union launcher perform wave union tdc fig wave union tdc board test conduct test perform wave union tdc propos fast ift integr insid fig cabl delay test approach evalu precis puls generat employ produc hit signal repetit frequenc uncorrel tdc clock hit signal connect tdc channel splitter fix cabl delay channel time interv cabl delay measur tdc channel fig typic statist spread cabl delay measur amount wave union transit standard deviat measur time interv rmsm repres system precis tdc channel singl tdc channel precis rmstdc equal rmsm rmstdc time precis reduc transit amount increas oscil period tosc std std rms plain tdc transit rms wave union tdc transit fig statist spread cabl delay test amount wave union transit effect bin size tdc reduc wave union techniqu fig bin effect subdivid transit amount increas binari code distribut distinct bin transit system clock period tclk bin size calcul tclk transit transit effect bin size reduc fig effect bin width plot time wave union transit conclus propos fast improv fat tree encod suitabl high speed ultra wide thermomet code binari code convers verifi effect method channel wave union tdc design bit thermomet code bit binari code encod implement clock cycl test indic encod function well stabli rms time precis achiev fact high speed bubbl error suppress abil good transport encod delay chain base fpga tdcs refer akindinov alici anselmo nucl mota christiansen debieux ieee nuclear scienc symposium confer record liu feng ieee transact nuclear scienc christiansen ieee solid state circuit magazin hervé cerrai caër nucl wang liu shen ieee transact nuclear scienc amiri boukadoum khoua ieee transact instrument measur song liu ieee transact nuclear scienc aloisio branchini giordano ieee npss real time confer shi ieee nuclear scienc symposium confer record time distribut rmstdc data gaussian fit fwhm time distribut rmstdc data gaussian fit fwhm binari code transit transit transit wang liu zhao ieee transact nuclear scienc vudadha makkena intern confer vlsi design sall vesterbacka european confer circuit theori design chuang liu ieee vlsi tsa intern symposium vlsi design autom test lee yoo choi midwest symposium circuit system kale palsodkar dakhol intern confer communic system network technolog kaess kanan ieee intern symposium circuit system wallac ieee transact electron comput sall vesterbacka ieee region confer tencon ieee transact onnuclear scienc liu feng yan nuclear scienc techniqu 