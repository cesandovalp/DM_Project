analys secur implement openid connect wanpeng chris mitchel secur group royal holloway univers london august abstract million user routin googl account log reli parti websit support googl openid con nect servic openid connect newli standardis singl sign protocol build ident layer top oauth protocol adopt support ident manag servic add ident manag function oauth system allow assur authen ticiti user number author analys secur oauth protocol openid connect secur practic remain open question report larg scale prac tical studi implement openid connect involv forens examin websit support sign studi reveal serious vulner number type allow attack log websit victim user examin suggest vulner caus combin design openid connect servic develop make design decis sacrific secur sim pliciti implement practic recommend rps help improv secur real openid connect system introduct order help allevi damag caus ident orient attack simplifi manag ident rang ident manag system oauth shibboleth cardspac openid forward replac well establish openid scheme openid connect build ident layer top oauth framework oauth framework enabl profil user provid authent user openid connect addit obtain profil user rps assur ident openid provid authent user openid connect involv interact core parti user attempt access servic protect user agent typic web browser employ user transmit request receiv respons web server openid provid googl method authent user generat assert thentic event attribut user reli parti wikihow protect servic consum ident assert generat idp order decid grant access user summari user employ user agent access resourc pro vide protect reli provid authent user openid connect finalis start half billion openid connect base user count provid googl paypal microsoft larg user base led larg number rps integr servic openid connect secur oauth foundat openid connect analys formal method focus plement oauth conduct newli standardis protocol clear prac tical implement openid connect proper follow specif larg scale googl servic derstand secur deploy openid connect order help answer question oper site gtmetrix top site provid servic english examin site support openid connect servic time survey earli websit examin potenti vulner report paper studi rps googl site treat black box http messag transmit browser care analys identifi vulner identifi vulner implement test exploit evalu attack surfac studi reveal serious vulner number type allow attack log websit victim user enabl compromis sensit user googl customis implement openid connect combin sdks web api sampl code result openid connect specifica tion act loos guidelin rps implement examin suggest identifi vulner caus develop misunderstand googl openid connect servic make design decis sacrific secur simplic implement attack discov cross site script xss cross site request forgeri csrfs well establish exploit attack techniqu openid connect protect million user account well sensit user store rps googl server april googl shut openid servic result huge number rps upgrad googl sign servic openid connect vital issu identifi address urgent googl consid issu updat advic rps servic connect notifi rps openid connect servic identifi serious vulner well googl remaind paper organis overview openid connect describ adversari model describ experi perform evalu secur implement openid connect reason identifi vulner discuss propos mitig vulner review work conclud paper openid connect introduct oauth enabl user grant onlin servic control access person detail email address birth pictur held third parti reveal password third parti help system oauth reli parti wikihow user provid password order access user store third parti googl ideal solut openid connect built ident layer top oauth protocol function add enabl rps verifi ident user reli authent process perform openid provid add ident manag function oauth system openid connect token order enabl verifi ident user openid connect add type token oauth token complement access token code oauth three type token issu function code opaqu bound identifi url main purpos openid connect authoris retriev token order help minimis threat aris exposur limit valid period typic set expir short issu access token credenti authoris access pro tect resourc store third parti opaqu string repres author issu code access data held thrid parti specif scope durat grant user enforc token claim authent user claim request claim insert token includ ident issu uniqu identifi ident intend recipi time issu expiri time take form json web token digit sign access token token verifi make call web api issu authent flow openid connect build user agent http redirect suppos user wish access servic protect consum token generat generat author request behalf user send typic web browser way authent user ask user grant permiss access user attribut generat author respons includ token type access token token claim user authent event receiv access token access attribut api provid receiv token inform authent user summaris fig figur openid connect protocol overview implement openid connect support type authent flow way system oper author code flow hybrid server side flow hybrid flow client side flow implicit flow pure server side flow pure server side flow rare googl state flow recommend detail descript three flow regist googl openid connect registr gather secur critic includ redirect uri origin redirect uri author code flow uri user agent redirect step step origin hybrid server side flow client side flow pointer domain issu uniqu identifi client secret client secret authent author code flow hybrid server side flow hybrid server side flow openid connect implement postmessag enabl cross domain communic script allow access web caus execut locat share protocol port number host postmessag method lift restrict provid secur pass messag domain oper postmessag exampl son shmatikov hybrid server side flow client side flow client run listen postmessag event detail descript hybrid server side flow user click googl sign button render websit send http https request generat openid connect author request send author request includ client identifi regist previ ousli respons type code token token request code access token token return direct googl redirect uri postmessag indic postmessag state opaqu client maintain state request callback step origin url path append scope scope request permiss user authent step skip return login form collect user authent user account password user complet login form grant mission access attribut store receiv permiss grant user generat html document author respons send author respons code access token token generat state step execut javascript insid html docu ment receiv previous step javascript send thoriz respons postmessag client run listen postmessag event client receiv author respons extract code send produc access token request send token endpoint direct request includ grant type author code indic code retriev access token code gen erat step redirect uri postmessag indic postm sage code client secret secret share check code client secret redirect uri correct respond access token token token step verifi token valid evid user authent web api call retriev user attribut access token evid implement hybrid server side flow code cess token token return googl javascript client run browser token reveal user agent applic access user agent client side flow author request respons employ client side flow hybrid server side flow differ flow client side flow code submit client side flow oper step step execut javascript insid html document receiv previous step javascript send author respons postmessag client run listen postmessag event receiv author respons client extract access token token verifi token token valid evid user authent web api call retriev user attribut access token evid client run updat display web base attribut retriev previous step author code flow advantag flow token user agent malici applic access user agent advantag token malici parti access sensit user data masquerad user authent issu pair token author code flow requir share secret flow involv return author code typic short live opaqu string token access token direct access token endpoint main step user click login button websit display send http https request generat openid connect author request send author request includ client client identifi regist respons type code indic author code flow redirect uri uri will redirect access grant state opaqu maintain state request callback step scope scope request permiss user authent step skip return login form collect user authent user complet login form grant mission access attribut store provid login form authent user generat author respons send author respons code author code generat state step redirect respons receiv step produc access token request send token endpoint direct request includ grant type code indic code retriev access token code step redirect uri client secret secret share check code client secret redirect uri correct respond access token token verifi token valid evid user authent call web api offer access token authoris order retriev desir user attribut adversari model assess secur implement openid connect implement specif rps servic consid scenario capabl adversari web attack share malici link post comment malici content stylesheet imag nign websit exploit vulner websit licious content forg web attack trigger web browser send http https request post method execut javascript script craft attack exampl web attack oper websit order collect access token passiv network attack abil intercept unen crypt data user browser monitor open network conduct secur analysi commerci deploy openid con nect sso system requir number challeng address includ lack access detail specif sso system undoc ument sourc code complex api sdk librari deploy sso system methodolog employ wang sun beznosov anal ysed browser relay messag brms treat rps idp black box analys brms produc author exploit point black box approach well vulner implement flaw attack vector studi uncov secur studi evalu secur openid connect captur brms rps develop python program pars brms simplifi analysi avoid mistak manual inspect experi perform account set special purpos time account access permiss rps support googl openid connect examin adopt author code flow hybrid server side flow adopt client side flow studi secur hybrid server side flow describ openid connect api postm sage deliv author respons client run browser receiv author respons extract code author respons submit code openid connect sign endpoint authent googl state javascript client run submit code receiv googl googl sign endpoint step code play critic role guarante user ident meant retriev access token token googl observ rps hybrid server side flow submit googl googl sign endpoint rps simpli submit googl append code submit googl access token led suspect rps base verif user ident sole googl code intend case web attack googl log account test rps hybrid server side flow vulner appear learn googl victim user simpl googl post url reveal googl attack googl search peo ple function find victim user attack visit chosen victim googl learn exam ple https post fiddler googl post url gmail account report find three websit recommen dation provid enabl develop problem wrong token access token bearer token parti possess access token access associ user attribut store googl intend access token contrast token design provid assur user authen ticat practic rps access token obtain assur user authent verifi make web api call token endpoint case parti access token imperson user simpli submit threat case malici routin access token googl googl openid connect abil log victim user rps access token authent user verifi unfortu nate rps hybrid server side flow submit access token googl sign endpoint step cess token authent user rps rps verifi access token retriev user attribut result rps examin vulner imperson attack test attack burp submit cess token websit target googl sign endpoint attack succeed log target victim user rps hybrid server side flow vulner attack vul nerabl rps requir addit evid user submit access token form googl email address attack access token ili googl email address googl addit step prevent imperson attack burp intercept access token state rps hybrid server side flow requir submiss access token googl sign endpoint step client run send access token googl sign endpoint ssl protect passiv network attack intercept oauth specif access token unencrypt user browser rps hybrid server side flow send access token unprotect sniffer written python implement test observ addit site ssl protect transfer code googl sign point access token subsequ store cooki cooki browser thefreedictionari link ssl protect access token observ pas sive eavesdropp privaci issu user choos openid connect log websit user attribut email address retriev reveal parti ssl connect establish protect user transmit browser explor greater detail user leakag happen client run browser send user token access token googl sign endpoint ssl protect step googl sign endpoint send user direct browser ssl protect ssl protect link googl sign endpoint chang http send browser describ passiv eavesdropp intercept access token rps hybrid server side flow retriev sensit user format notabl includ googl email address state token json web token user email address googl encod cleartext result obtain token rps refer send token addit access token googl sign endpoint passiv web attack retriev user request googl access token enabl ssl protect googl sign endpoint return user infor mation direct user browser send user googl sign endpoint ssl protect ssl protect link googl sign endpoint chang http send user user browser result user privaci guarante rps examin sniffer python implement demonstr feasibl attack session swap discuss earlier client run send openid token code access token token googl googl sign endpoint step openid specif recommend state append client send token googl sign endpoint state bound browser session client fail send state attack execut session swap attack perform step attack log websit count step intercept token generat googl step attack construct request googl sign endpoint includ token attack insert request html document src attribut img ifram tag public http server victim user induc visit websit fere web html construct describ detail will automati calli post method send attack construct request result user session websit will bound account observ client hybrid server side flow post method submit token server accompani state static img ifram tag perform attack type work rps browser will automat method retriev img ifram data order post method submit token creat special html conduct session swap attack javascript creat ifram uniqu browser construct form insid ifram action point googl sign endpoint token form input configur html submit form html document load browser deploy attack construct html public web server victim user visit javascript insid html automat submit token post method result victim session bound session swap attack perform attack attack collect sensit user victim user updat credit card websit credit card will written account rps adopt hybrid server side flow vulner attack rps categori submit code googl sign endpoint code time attack updat attack html time retriev victim user vulner rps access token googl submit googl sign endpoint case attack updat attack html frequent studi secur author code flow start observ oauth author code flow implement step token endpoint provid implement oauth check april return token know detail intern oper distinguish openid connect oauth paper cover case googl return code googl sign endpoint discuss openid connect author code flow rps concern oauth differ secur analysi rps examin thoriz code flow hybrid server side flow plement author code flow http status code redirect techniqu code deliv author respons googl sign endpoint intercept access token author code flow code return googl googl sign endpoint step token tran mit author procedur receiv code retriev access token googl step access token retriev user attribut googl step log user websit ssl protect communic googl sign endpoint passiv web attack intercept code passiv web attack code retriev access token googl will client secret share googl observ rps author code flow googl sign endpoint return access token browser bind user session rps ssl protect transfer access token passiv web attack access token return googl sign endpoint steal access token cross site script automat author grant featur generat thoriz respons automat user maintain session googl grant permiss concern ing featur attack steal user access token exploit xss vulner browser test feasibl attack exploit written javascript implement exploit take advantag reveal vul nerabl built browser allow attack conduct univers xss attack exploit browser event send forg author request thoriz server respons type code step chang respons type code token token user log googl account grant permiss googl automat generat author respons involv user respons append uri fragment redirect uri step step googl sign endpoint expect uri fragment predefin error will generat fail connect error exploit javascript extract author respons url error send open window event trigger open window send access token server rps adopt autho rizat code flow vulner attack vulner android version april account android privaci issu hybrid server side flow code submit googl sign endpoint step user informa tion googl token transmit author procedur user leakag occur googl sign endpoint send user direct browser ssl protect studi reveal rps author code flow return user browser direct ssl protect passiv web attack intercept sensit user user open network session swap author code flow enabl anti csrf measur append state bound browser session token protect googl sign endpoint web attack launch session swap attack precis describ hybrid server side flow session swap attack author code flow method submit code googl sign endpoint attack simpli insert forg request src attribut img ifram tag html document victim user visit malici html browser will automat send request googl sign endpoint method rps author code flow vulner attack code time attack updat time attack visit victim user result attack harm session swap attack hybrid server side flow access token multipl time submit googl sign endpoint dashboard utm_sourc suzunon forc login csrf attack csrf login attack oper context ongo interact tween target web browser run behalf target user target attack malici websit target browser initi openid connect author request automat author grant featur receiv request googl generat author respons deliv involv user target user current log googl browser will send cooki target googl generat token attack suppli author request will process malici author request initi target user will generat author respons send target browser send spurious request way exampl malici site visit browser html img src attribut url malici request caus browser silent method send request experi rps adopt thoriz code flow vulner attack consequ attack attack victim user log long user log googl damag user experi websit victim user dislik annoy automat login featur discuss openid connect build top current web infrastructur web applic vulner cross site request forgeri cross site script common exploit exist vulner exacerb threat pose implemen tation issu identifi vulner describ caus binat characterist googl servic design cision appear simplic secur consid greater detail class vulner identifi arisen customis hybrid server side flow openid connect specif code return googl sign endpoint step describ rps hybrid server side flow proper follow specif client submit access token token googl googl sign endpoint appear openid connect specif act loos guidelin rps author request generat hybrid server side flow rps openid connect api will includ respons type code token token author spons client code access token token author code flow code turn googl sign endpoint step client exist abil customis hybrid server side flow fact experi rps customis hybrid server side flow customis improv perform openid connect system well enhanc user experi risk introduc vulner system allow attack log victim user imperson victim user access token generat code access token token return googl insid html document valu reveal user agent applic browser plug access user agent plug user agent vulner allow attack access valu attack steal access token exampl malici plug read content html access token confus state hybrid server side flow develop construct author request googl openid connect api client mission scope code valu author request handl api valu includ state bind author respons author request prevent csrf attack simplifi job develop support openid connect easier plement cost increas attack surfac open protocol vulner order understand api deal state implement googl openid con nect api surpris state extract client null googl fail deliv state client state mitig threat csrf attack observ rps author code flow send null state googl sign endpoint state generat googl openid connect api bound session extract client state bound session implement protect googl sign endpoint csrf attack rps hybrid server side flow fail step result vulner session swap attack describ googl recommend rps state protect googl sign endpoint examin googl openid connect sampl code reveal googl includ state exampl client generat ajax request send data lack state paramet sampl code complex implement anti csrf measur help explain rps hybrid server side flow vulner attack automat author grant automat author grant featur implement openid connect enhanc user experi system perform featur user click button popup window wish log order grant author featur harm allow attack steal access token forc user log observ hybrid server side flow ifram manag session client suppos user grant permiss log googl account visit login ifram point author request automat author grant featur browser method retriev author respons googl involv user user agent applic plug access user agent extract author respons expos hybrid server side flow attack recommend openid connect deploy rps appear increas number rps support googl servic will impl ment openid connect sso googl shut openid servic studi reveal serious vulner exist system danger vulner will replic futur system number recommend direct rps design address vulner identifi recommend appli rps googl servic googl broader applic reason make recommend address problem exist current system help ensur futur system built robust recommend rps openid connect system case hybrid server side flow develop respons design client action receiv author respons googl result secur openid connect system depend secur expertis develop recommend rps customis hybrid server side flow rea son openid connect vulner attack describ section rps customis hybrid server side flow submit code googl sign endpoint client run submit access token googl authent user customis hybrid server side flow improv user experi enc effici websit cost expos system attack rps implement openid connect hybrid server side flow strict conform openid connect specif deploy countermeasur csrf attack reason openid connect system investig vulner csrf session swap attack rps implement well countermeasur attack order prevent csrf attack googl recommend rps includ state paramet openid connect author request respons rps follow recommend constant predict state rps clude fix state openid connect author request state fix uniqu bound browser session allow attack forg respons distinguish legitim respons pro duce valid user forg respons produc attack case inclus state protect csrf attack rps generat guessabl state bound browser session state verifi valid respons recommend openid connect sso system design process api rps wish support compli requir play critic role system recommend googl remov token author request brid server flow hybrid server side flow token author request googl return access token client allow client submit access token googl sign endpoint case rps ing hybrid server side flow investig practic rise rang imperson attack send access token creat risk enabl ssl protect googl sign endpoint passiv network attack steal enabl malici imperson ate user rps submit access token googl sign endpoint allow possibl misus token compromis sensit user data add state sampl code typic provid sampl code help develop websit interact propriat discov googl includ state sampl code hybrid server side flow reason specul main reason interact analys vul nerabl session swap attack case state includ sampl code number fell allow state hybrid server flow state author request hybrid server side flow automat handl googl openid con nect api client extract state null state bound browser session protect csrf attack better handl state googl api handl addit googl check sourc code script ensur state extract client notifi parti report issu describ three parti februari provid advic help problem juli three fix problem ignor warn third termin support googl sso servic april notifi googl issu describ paper googl acknowledg problem describ notifi openid connect group work oauth predecessor openid connect analys formal method pai confirm secur issu describ oauth thread model alloy framework chari analys oauth univers compos secur framework oauth secur communic link ssl protect frostig slack discov cross site request forgeri attack implicit grant flow oauth murphi framework bansal analys secur oauth webspi proverif model work base abstract model oauth delic implement detail ignor rang work explor secur properti real implement oauth conduct wang examin number deploy sso system focuss logic flaw system includ openid parallel sun beznosov studi deploy system oauth provid servic english mitchel examin secur deploy oauth system provid servic chines parallel zhou evan conduct larg scale studi secur oauth impl mentat chen shehab mohsen look secur implement oauth mobil platform despit work oauth conduct secur openid connect system conclud remark paper report field studi secur prop erti implement openid connect examin curiti rps implement support googl openid connect servic gtmetrix list top site method olog discov vulner wang sun beznosov analys http mes sage transmit browser approach key respect class adversari threat model malici collect user access token imperson user rps second focuss studi openid connect oauth generic sso system allow identifi gap implement specif openid connect discov number vulner allow attack log victim user propos practic improv adopt openid connect rps refer web messag http org webmessag owasp top ten project https googl openid connect hybrid server side flow https web signin microsoft openid connect https librari azur openid connect session manag http spec openid connect session html paypal openid connect https doc integr direct ident log paypal googl oauth client side https ident protocol googl openid https account doc openid googl openid connect https account doc openidconnect googl openid connect server side flow https web signin server side flow gtmetrix top site http html oauth author code flow https ident protocol verifi token https ongo token rafay baloch android browser origin polici bypass http android browser origin chetan bansal karthikeyan bhargavan antoin delignat lavaud sergio maffei discov concret attack websit author formal analysi journal comput secur chetan bansal karthikeyan bhargavan maf fei webspi web applic model http webspi csf adam barth collin jackson john mitchel robust defens cross site request forgeri peng ning paul syverson somesh jha editor proceed acm confer comput communic secur ccs alexandria virginia usa octob acm adam barth collin jackson john mitchel secur frame communic browser commun acm bruno blanchet ben smyth proverif cryp tograph protocol verifi formal model http person bblanch proverif david chappel introduc window cardspac http librari aspx suresh chari charanjit jutla arnab roy univers compo secur analysi oauth iacr cryptolog eprint archiv eric chen yutong pei shuo chen yuan tian robert kotcher patrick tagu oauth demystifi mobil applic develop gail joon ahn moti yung ninghui editor proceed acm sigsac confer comput communic secur scottsdal usa novemb acm philipp ryck lieven desmet wouter joosen frank piessen automat precis client side protect csrf attack vijay atluri claudia editor comput secur esor european symposium comput secur leuven belgium septemb proceed volum lectur note comput scienc springer david dill murphi verif system rajeev alur thoma henzing editor comput aid verif ternat confer cav brunswick usa juli august proceed volum lectur note comput scienc springer dick hardt oauth author framework octob http html daniel jackson alloy http communiti jone dick hardt editor oauth author framework bearer token usag https html michael jone nat sakimura john bradley json web token jwt http html draft ietf oauth json web token nenad jovanov engin kirda christoph kruegel prevent cross site request forgeri attack second intern confer secur privaci communic network work shop securecomm baltimor aug septemb ieee engin kirda christoph kru gel giovanni vigna nenad vanov nox client side solut mitig cross site script ing attack hisham haddad editor proceed acm symposium appli comput sac dijon franc april acm wanpeng chris mitchel secur issu oauth sso implement sherman chow jan camenisch luca chi kwong hui siu ming yiu editor secur intern confer isc hong kong china octob proceed volum lectur note comput scienc springer torsten lodderstedt mark mcgloin phil hunt oauth threat model secur consider http html ziqe mao ninghui ian molloy defeat cross site request forgeri attack browser enforc authent protect roger dingledin philipp goll editor financi cryptographi data secur intern confer accra beach barbado februari revis select paper volum lectur note comput scienc springer yacin nadji prateek saxena dawn song document structur tegriti robust basi cross site script defens proceed network distribut system secur symposium ndss san diego california usa februari februari internet societi suha pai yash sharma sunil kumar radhika pai sanjay singh formal verif oauth alloy framework proceed intern confer communic sys tem network technolog csnt ieee david recordon brad fitzpatrick openid authent final http spec openid authent html nat sakimura john bradley michael jone breno medeiro mortimor chuck openid connect core http spec openid connect core html moham shehab fadi mohsen secur oauth implement smart phone elisa bertino ravi sandhu jaehong park editor fourth acm confer data applic secur privaci codaspi san antonio usa march acm quinn slack roy frostig murphi analysi oauth implicit grant flow http class sooel son vitali shmatikov postman ring attack defend postmessag websit annual network distribut system secur symposium ndss san diego california usa februari internet societi san tsai sun konstantin beznosov devil impl mentat detail empir analysi oauth sso system ting georg danezi virgil gligor editor acm con ferenc comput communic secur ccs raleigh usa octob acm bart van delft martijn oostdijk secur analysi openid elisabeth leeuw simon fischer bner lothar fritsch editor polici ident manag second ifip work confer idman oslo norway novemb proceed volum ifip advanc communic technolog springer philipp vogt florian nentwich nenad jovanov engin kirda christoph kru gel giovanni vigna cross site script preven tion dynam data taint static analysi proceed network distribut system secur symposium ndss san diego california usa februari march internet societi rui wang shuo chen xiaofeng wang sign count facebook googl traffic guid secur studi commerci deploy singl sign web servic ieee symposium secur privaci san francisco california usa ieee comput societi gari wassermann zhendong static detect cross site script vulner wilhelm scha fer matthew dwyer volker gruhn editor intern confer softwar engi neer ics leipzig germani acm william zeller edward felten cross site request forgeri ploitat prevent bericht princeton univers yuchen zhou david evan ssoscan autom test web applic singl sign vulner kevin jaeyeon jung editor proceed usenix secur symposium san diego usa august usenix associ 