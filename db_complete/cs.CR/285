spresso secur privaci respect singl sign system web daniel fett ralf k√ºster guido schmitz univers trier germani fett kuester schmitzg uni abstract singl sign sso system openid oauth allow web site call reli parti rps deleg user authent ident provid idp facebook googl system popular provid conveni user log rps move burden user authent rps idp downsid current system respect user privaci idp learn user log except browserid system mozilla persona current sso system design user privaci mind discov attack exploit design flaw browserid browserid provid user privaci paper propos privaci respect sso system web call spresso secur privaci respect singl sign system easi decentr platform independ base sole standard web featur browser extens plug execut exist sso system numer attack system illustr design secur sso system high trivial carri formal analysi spresso base express model web order formal prove spresso enjoy strong authent privaci properti tabl content introduct descript spresso main featur login flow implement detail discuss web model communic model web system web browser indistinguish web system formal model spresso privaci spresso authent spresso work conclus refer web model communic model script process web system messag data format notat url origin cooki http messag dns messag dns server detail descript browser model notat terminolog web browser state descript web browser atom process formal model spresso outlin address domain name key secret ident tag ident assert corrupt process overview ssl key map web attack network attack browser reli parti ident provid forward dns server spresso script formal secur properti authent proof theorem properti swsauth properti properti indistinguish web system formal proof privaci formal model spresso privaci analysi definit equival configur privaci proof introduct web base singl sign sso system allow user identifi call reli parti servic ident manag ident provid idp facebook googl sso system user password log authent idp exchang data convinc ident log idp user log click provid password sso system attract user system conveni rps burden user authent includ exampl handl user password lost password shift idp sso system popular web year sso system develop openid googl yahoo aol wordpress exampl oauth twitter facebook paypal microsoft github linkedin exampl promin system sso system includ saml shibboleth cas webauth downsid system except exist sso system design respect user privaci idp user log servic user fact exchang user data idp rps direct login process key protocol openid oauth exampl idp easili track user system design intent respect user privaci browserid system system develop mozilla market persona sever attack browserid discov privaci browserid complet broken attack allow malici idp version attack arbitrari parti check login status user effort detail attack wors attack exploit design flaw browserid discuss fix major redesign system essenti requir build system discuss lack privaci issu motiv design system goal work design sso system respect user privaci sens describ idp complet malici track rps user log histori sso system high trivial design secur sso system privaci requir authent requir attack easili unnot fact numer attack sso system includ attack oauth openid googl facebook connect saml browserid uncov compromis secur servic user design implement privaci respect sso system carri formal secur analysi system base express model web infrastructur order provid formal secur guarante contribut work contribut paper work propos system spresso secur privaci respect singl sign sso system respect privaci system allow user log rps email address user authent idp host email address idp learn user log strong authent privaci guarante spresso design browser platform devic purpos spresso base sole standard web featur browser extens plug browser independ execut discuss spresso design open decentr system exampl contrast oauth spresso requir prior coordin setup rps idp user log email address spresso support formal prove spresso enjoy strong authent privaci properti analysi base express dolev yao style model web infrastructur web model design independ specif web applic close mimic publish facto standard specif web instanc http standard associ propos standard comprehens web model http request respons includ header cooki locat strict transport secur sts origin header model model web browser captur concept window document ifram includ complex navig rule well technolog web storag cross document messag postmessag javascript model abstract call script process creat ifram initi xmlhttprequest xhrs browser corrupt dynam adversari web model employ analyz trace base properti authent properti work formul time strong indistinguish privaci properti web applic general definit tailor specif web applic analysi spresso properti requir adversari distinguish system order formul properti modifi extend web model final formal spresso web model formal state prove strong authent privaci properti spresso authent properti prove central sso system formul properti privaci properti prove malici idp distinguish honest user log analysi carri work interest web applic rare analyz base express web model structur paper describ system discuss motiv design choic recal general web model explain modif extens mention strong general definit indistinguish privaci web applic present provid formal model spresso base state analyz privaci authent spresso section work discuss conclud detail proof appendix onlin demo sourc code spresso descript spresso describ main featur spresso provid detail descript system implement detail provid addit intuit motiv design spresso discuss potenti attack spresso prevent main featur spresso enjoy key featur strong authent privaci spresso design satisfi strong authent privaci properti authent fundament secur properti sso system adversari log servic honest user adversari log browser honest user ident ident inject depend servic provid violat allow adversari track honest user user secret note attack authent deploy sso system oauth openid browserid authent assum involv idp honest privaci concern malici idp properti requir malici idp track rps specif user log mention introduct browserid sso system design provid privaci fact exchang user data idp rps direct key protocol openid oauth exampl protocol idp easili track user log browserid fail provid privaci subtl attack allow idp version attack arbitrari parti check login status user run malici javascript browser idp check user log trigger automat login process test ifram creat process exist ifram reveal login status malici idp track user log discuss fix major redesign browserid work consid rpdoc idp fwd user enter email address click login rpnonc iakey tagkey loginsessiontoken tag enc rpdomain rpnonc tagkey rpredirdoc redirect idpdoc email tag fwddomain iakey url fragment identifi user enter secret check secret email sig tag email fwddomain kidp eia enc iakey fwddoc dec tag tagkey rpdomain dec eia iakey tag email fwddomain checksig pub kidp servicetoken rpdoc idpdoc fwddoc idp fwd user enter email address click login post startlogin email well spresso info rpnonc iakey tagkey loginsessiontoken tag enc rpdomain rpnonc tagkey http respons tagkey fwddomain loginsessiontoken open loginsessiontoken redirpath loginsessiontoken http respons rpredirdoc email tag fwddomain iakey redirect idpdoc email tag fwddomain iakey url fragment identifi well spresso login user enter secret post loginxhr secret email tag fwddomain check secret email sig tag email fwddomain kidp http respons eia enc iakey creat tag eia well spresso proxi readi tagkey origin https fwddomain dec tag tagkey rpdomain eia origin https rpdomain post login eia loginsessiontoken dec eia iakey tag email fwddomain checksig pub kidp servicetoken http respons login success servicetoken https messag xhrs https postmessag browser command fig spresso login flow major redesign spresso share basic concept browserid spresso base browserid system built scratch discuss design secur sso system trivial attack easi overlook mention introduct design implement spresso meet strong authent privaci properti perform formal analysi spresso express model web infrastructur order spresso fact meet properti open decentr system creat spresso decentr open system spresso user identifi email address email provid certifi user authent compar openid user learn complic identifi approach browserid browserid central author spresso discuss contrast oauth spresso requir prior coordin setup rps idp user log email address spresso support email address lack spresso support seamless fallback provid discuss adher web standard spresso base sole standard web featur browser extens plug client side execut guarante spresso browser platform devic includ desktop comput mobil platform instal softwar browser note smartphon exampl browser support extens plug login flow explain spresso typic login flow system spresso three distinct type parti reli parti rps web site user wish log ident provid idp provid rps proof user own email address ident forward fwds forward messag idp rps browser start overview login flow flow detail overview high level login flow consist step web site user enter email address creat call tag encrypt domain nonc fresh generat symmetr key tag email address forward idp privaci requir browser idp learn data receiv note tag domain encrypt form idp sign tag email address provid user log idp user log signatur call ident assert transfer browser check signatur consist data sign consid user email address log note pass fwd determin deliv correct document idp ensur privaci requir idp suppos intend detail flow detail spresso login flow refer step protocol depict figur name idp fwd server respect parti rpdoc rpredirdoc idpdoc fwddoc name html document deliv respect parti login flow involv server idp fwd well browser gray background window ifram creat window rpdoc second login dialog creat rpdoc initi rpredirdoc idpdoc third ifram insid login dialog document fwddoc fwd load step protocol user open login actual login start user enter email address rpdoc send address post request identifi idp domain email address retriev support document idp document retriev fix url https idpdomain well spresso info public signatur verif key idp select nonc symmetr key rpnonc iakey tagkey loginsessiontoken creat tag tag encrypt domain rpdomain nonc rpnonc tagkey standard dolev yao notat denot term tag enc rpdomain rpnonc tagkey select fwd fix set store tag iakey fwd domain email address session data store session key loginsessiontoken send tagkey fwddomain loginsessiontoken respons post request rpdoc rpdoc open login dialog ultim window login dialog idp idpdoc user log idp log preserv privaci discuss rpdoc launch dialog url idpdoc rpdoc open login dialog url rpredirdoc attach loginsessiontoken rpredirdoc load redirect login dialog idpdoc pass email address tag fwd domain iakey store session key loginsessiontoken idpdoc browser load idpdoc idp user enter match email address password email address tag fwd domain idp idp verifi user credenti creat ident assert signatur sig tag email fwddomain kidp privat sign key kidp return idpdoc note signatur data sign avoid fwd learn discuss idpdoc encrypt iakey eia enc iakey idpdoc open ifram url fwddoc pass tag encrypt fwddoc ifram load fwddoc send open window rpdoc postmessag sole content readi trigger rpdoc send tagkey fwddoc postmessag fwd https declar allow receiv messag fwddoc key decrypt tag learn intend receiv action fwd forward encrypt eia postmessag rpdoc https origin allow receiv rpdoc receiv eia send loginsessiontoken decrypt eia retriev check valid signatur tag email fwddomain verif key pub kidp idp tag email fwddomain session data identifi loginsessiontoken user identifi email address log mechan persist log state point scope spresso analysi model standard session base login assum creat session browser identifi fresh chosen token servic token send token browser implement detail develop proof concept implement spresso line javascript html code present featur spresso typic idp implement sourc code onlin demo model present close implement three server idp fwd written javascript base built crypto api client side web cryptographi api encrypt employ gcm mode provid authent signatur creat verifi rsa data pass idpdoc fragment identifi url hash idp fact idp well offer form authent tls client authent factor authent messag window browser origin defin domain connect domain http https discuss order provid intuit motiv design spresso secur privaci properti inform discuss potenti attack system measur design implement spresso prevent attack attack illustr complex difficulti design secur privaci respect web base sso system section formal prove spresso strong authent privaci properti detail model web infrastructur discuss aspect spresso includ usabl perform conclud comparison spresso browserid malici imperson attack attack launch man middl attack spresso play role server rpdoc user attack malici server domain rpa deliv malici script honest rpdoc script browser assum user log email address rpa log idp correspond email address attack browser initi login process rpb email address creat tag form enc rpb rpnonc tagkey domain honest rpb rpa idp creat tag email address deliv browser deliv window run malici rpdoc script attack finish log process rpb servic token rpb log rpb honest user assum fwd honest discuss malici fwds fwd prevent kind attack fwd forward encrypt postmessag domain list tag case rpb attack domain document load window rpa transmit attack appli attack navig window domain rpa step formal analysi present section prove attack exclud spresso note order sure postmessag deliv correct window technic window expect origin fwd standard featur postmessag mechan allow origin intend recipi postmessag malici idp malici idp log user ident attack kind browserid spresso idp select alter ident user log ident fix step check step formal analysi attack spresso idp undermin privaci find request spresso idp gather email tag fwddomain gather state infer corel sourc time https request support document user login minim side channel cach support document automat refresh cach cach document hour period automat refresh cach addit rps tor network retriev support document order hide address assum support document idp independ specif login request user formal analysi spresso fact enjoy strong privaci properti section browserid malici idp fact parti malici script browser check presenc absenc ifram login process lead privaci break mention earlier formal analysi impli spresso malici fwd malici fwd cooper malici enabl man middl attack discuss undermin authent guarante system malici fwd collabor malici idp send idp undermin privaci rps specif fwd fwddomain reveal easi avoid practic set fwds rps trust big rps random choos fwds login process system provid authent privaci requir fwds behav honest discuss way forc fwd behav honest suspect avoid fwds honest compon practic sso system suppos provid authent privaci system step flow idpdoc return constraint forward document fact document misus log ident parti break authent second ident reveal idp privaci current browser mechan secur forward disclos ident idp enforc honest fwds discuss exist upcom technolog enforc honest behavior fwds note spresso fwd chosen user log choos fwd trust great interest trustworthi fwd mention malici fwd allow attack log honest user misus servic undermin confidenti integr data store definit prevent second note fwd learn email address fwd email address encrypt symmetr key unknown fwd spresso provid fwd track specif user log enforc honest fwds note honest fwd server suppos deliv fix javascript browser javascript code short line code code ensur fwd preserv authent privaci track data fwd server current technolog user browser extens simpl sure fact specif javascript deliv fwd respect request result fwd forc behav honest user trust fwd approach extens replac fwd complet lead simplifi protocol case spresso provid authent privaci trust fwd solut common problem work platform platform browser support extens solut extens check correct javascript load work user platform albeit reduc secur privaci guarante nativ web technolog call subresourc integr sri current develop sri allow document creat ifram attribut integr take hash browser guarante document load ifram hash exact essenti creator ifram enforc ifram load specif document enabl spresso automat check integr fwddoc extens refer header privaci refer sic header set browser caus navig set common browser preserv privaci load idpdoc initi rpdoc refer header set domain consequ idp read refer header user log privaci broken special attribut link html introduc refer header suppress rel noreferr link open window window handl open window open handl essenti spresso postmessag step open window idpdoc preserv open handl time hide refer open window redirector document load step navig window idpdoc link noreferr attribut set trigger javascript step note signatur typic sign hash messag common signatur scheme fwd extract email address addit spresso encrypt sure case matter signatur scheme malici fwd set cooki browser fingerprint track behavior specif browser email address org sri refer header clear open handl preserv formal analysi impli solut privaci preserv cross site request forgeri cross site request forgeri critic log user ident spresso employ session token store cooki state javascript avoid cross origin cross domain cooki attack addit check origin header login request sure login trigger third parti attack web formal analysi impli cross site request forgeri attack spresso phish notic spresso user verifi locat tls certif window check locat bar browser user check enter password idpdoc load ifram set strict transport secur header help avoid phish attack tag length side channel length tag creat step depend length rpdomain tag idp idp infer rpdomain length tag rfc domain name charact long appropri pad encrypt bit plaintext block length tag will reveal rpdomain perform spresso standard browser featur employ symmetr encrypt decrypt signatur requir minim implement https request respons pose perform overhead modern web applic browser server prototyp unoptim implement login process take time enter email address password usabl spresso user identifi email address identifi user easili memor email provid serv ident provid web applic today email address primari identifi password specif web site user sign url secret token email address user check email click url confirm control email address creat password web site spresso seamless integr sign scheme great simplifi email provid idp user support spresso spresso login flow launch direct user enter email address click login button avoid user password email confirm user log idp user enter password user javascript disabl automat seamless fallback classic token base approach detect idp support spresso step protocol contrast login system googl user decid log spresso describ seamless integr spresso privaci guarante sso system spresso disadvantag user idp track rps user log illustr spresso sign web site conveni user enter email address web site press login button log respect idp password spresso user free email address extend spresso extend idp sign addit email address user attribut oper fwd oper fwd cheap task serv static file parti fwd user rps feel confid fwd oper trust profit organ mozilla eff option data uri load redirector document rpdoc refresh header contain meta tag rid refer header wors cross browser compat refresh header lack standard bit block suffici domain name addit block rpnonc comparison browserid browserid sso system design provid privaci idp rps log mention sever attack discov privaci promis browserid broken idp parti track login behavior user regain privaci requir major redesign system essenti complet system point browserid disadvantag reli singl trust server complex server interact login process import design full login behavior user email address user log final browserid complex sso system network inter frame messag typic login compar spresso complex impli secur vulner unnot easili fact attack browserid break authent privaci claim discov design built spresso scratch redesign browserid design spresso fact browserid exampl https signatur idp spresso symmetr encrypt browserid user brower creat public privat key pair idp sign public key entiti spresso browserid well spresso reli mention singl complex essenti omnisci trust parti complet protocol flow design spresso slimmer browserid web model formal secur analysi spresso present section base general dolev yao style web model mention introduct chang detail model facilit definit indistinguish privaci properti simplifi handl nonc remov determinist choic http refer header noreferr attribut link version web model full model includ chang provid appendic communic model main entiti communic model atom process model web browser web server dns server well web network attack atom process listen address set atom process form call system atom process communic event consist messag well receiv sender address step event chosen determinist current pool event deliv atom process listen receiv address event atom process process event output event pool event messag process defin term messag event usual dolev yao model messag express formal term signatur signatur term messag consid web model constant address ascii string nonc sequenc project symbol function symbol includ symmetr encrypt decrypt digit signatur messag defin ground term term variabl exampl term notat describ messag pub denot public key belong privat key provid exampl messag web model http request repres ground term nonc method spresso requir fwd behav honest login process fwd server provid fix singl simpl javascript server interact fwd full login process choos fwd trust discuss forc fwd provid expect javascript http request respons well postmessag leav user request gui element resourc post domain path url paramet request header cooki messag bodi instanc http request url http model term httpreq header bodi empti https request form enca pub fresh symmetr key nonc generat sender request typic browser respond suppos key encrypt respons event term form receiv sender address messag exampl http messag dns request respons equat theori associ signatur defin usual dolev yao model theori induc congruenc relat term captur mean function symbol instanc equat equat theori captur asymmetr decrypt deca enca pub exampl deca enca pub term equival equat theori atom process system run atom dolev yao process system run system defin atom dolev yao process tupl set address process listen set state formal term initi state relat take event state input determinist return state sequenc event relat model comput step process receiv event state determinist move state output set event requir event state output comput formal deriv usual dolev yao style current input event state note definit atom process contain set nonc process set consid global sequenc unus nonc nonc generat atom process global sequenc call attack process atom process record messag receiv output event deriv record messag attack process maxim power process carri attack process perform parametr set sender address attack corrupt process browser system set atom process configur system consist current state atom process system pool wait event formal model sequenc event pool model multiset mention sequenc unus nonc system initi sequenc event sequenc configur configur initi deliv wait event preced configur atom process listen receiv address event turn perform comput step relat initi configur consist initi state atom process sequenc initi infinit sequenc unus nonc script process web model defin script process model client side script technolog javascript script process simpli script defin process call browser run browser state script comput relat output term repres intern state command interpret browser requir output deriv input attack process call attack script ratt output deriv input web system web system formal web infrastructur web applic formal web system tupl script compon compon denot system set process defin honest process web attack network attack process web attack listen send messag address network attack listen spoof address maxim power attack attack corrupt parti analysi concret web system typic network attack web attack subsum network attack web attack network attack honest process web browser web server dns server model web server heavili depend specif applic web browser model independ specif web applic present second compon finit set script includ attack script ratt concret model spresso model set ratt describ set honest script web applic consider malici script model worst case malici script ratt third compon script inject map script string represent script constant messag http respons final sequenc event infinit number event form trigger address web system web system initi web browser sketch model web browser full detail provid appendix web browser model process honest browser thought honest user model browser user action model determinist action web browser exampl browser determinist link web user data password ident store initi state browser web need autofil featur browser user ident password state web browser model term tree open window document list cooki localstorag sessionstorag data dns server address data browser state window subterm complex window subterm open window time insid window list document repres histori document open window document activ document present user readi interact document script load web server repres load html document list window model ifram script exampl navig creat window send xhrs postmessag submit form set chang cooki localstorag sessionstorag data creat ifram activ browser script data access limit view document window cooki well localstorag sessionstorag figur overview browser relat defin browser behav exampl trigger messag deliv browser browser determinist chose action instanc action activ document select determinist script trigger script input outlin output command exampl follow hyperlink href case browser will follow link creat dns request respons dns request arriv actual http request url defin script will respons http request arriv browser creat document content respons complex navig secur rule ensur script manipul specif aspect state browser corrupt process input messag fullcorrupt iscorrupt fullcorrupt closecorrupt iscorrupt closecorrupt trigger determinist choos action action call script activ document output state command command href initi request command ifram creat subwindow initi request command form initi request command setscript chang script document command setscriptst chang state script document command xmlhttprequest initi request command forward navig window command close close window command postmessag send postmessag document action initi request url window action reload document dns respons send correspond http request http respons decrypt find refer refer window creat document window refer document add respons bodi script input fig basic structur web browser relat extract process step case browser corrupt web network attack browser model compris type corrupt close corrupt model browser close user data remov session cooki open window attack full corrupt data remov advanc corrupt browser behav attack process indistinguish web system defin indistinguish web system definit tailor specif web applic independ interest definit idea trace equival dolev yao model turn abstract version cryptograph indistinguish intuit web system indistinguish true attack perform action system sequenc messag obtain run point view usual dolev yao model sequenc static equival general web system allow determinist action honest parti sequenc action attack induc set run indistinguish action attack induc action system exist system induc attack action sequenc messag attack obtain run attack defin action attack web system requir care attack control compon system partial web attack network attack control network attack control server web server dns server browser control script run honest browser attack script ratt run browser dishonest browser complet control attack model singl action attack call web system command confus command output script browser command form cmdswitch cmdwindow url compon determin event pool event process event deliv process recal network attack listen address determin process process event case depend process event deliv depend event denot process event corrupt web attack network attack corrupt browser server state process output determin term term evalu current state process input honest browser trigger messag dns http respons browser process usual determinist iii honest browser trigger messag three action browser determinist choos open window reload document script term cmdswitch select action choos open window document will load url url remain case cmdwindow determin window reload script execut script execut script attack script output script deriv determinist term term evalu data provid browser command process determinist browser script execut honest script ratt script evalu command process browser note script perform determinist action honest process browser process evalu usual comput determinist honest process determinist call finit sequenc command schedul web system script schedul induc set finit run obvious denot set intuit schedul model attack action note consid strong attack determin action dishonest process attack script schedul event event intend attack clear attack explicit event intend defin indistinguish web system mention recal definit static equival messag messag static equival written term variabl nonc iff test perform attack yield result exampl nonc constant enca pub enca pub intuit case attack privat key terminolog script web system attack process script web system distinguish attack process finit system denot state indistinguish definit will consid state distinguish attack process suffici attack send data process readi defin indistinguish web system natur definit web system distinguish attack process system indistinguish written iff schedul exist formal model spresso formal model spresso close descript implemen tation system model basi formal analysi privaci authent properti present section script ratt att_script script_rp script_rp script_rp_redir script_rp_redir script_idp script_idp script_fwd script_fwd fig list script respect string represent model spresso web system sens call sws script spresso web system form describ set hon web net consist finit set web attack process web network attack process net finit set fwd forward finit set web browser finit set web server reli parti finit set idp web server ident provid finit set dns dns server hon idp fwd dns figur set script respect string represent defin map script set trigger event sketch process script appendix full detail mention model close descript implement system browser defin describ reli parti web server distinct path serv web script_rp startlogin accept post request issu fresh nonc redir accept request valid login session token serv script_rp_redir redirect browser idp login accept post request login data login process script_rp run browser check data data consid valid issu servic token list token state intuit client token servic idp idp web server three distinct path well spresso login serv login dialog web script_idp well spresso info serv support document public key sign issu sign ident assert user authent idp credenti idp track state user session authent user receiv idp forward fwd web server state stateless serv script script_fwd corrupt dns server dns assign domain name address answer dns request browser rps idp fwds corrupt receiv messag corrupt start collect incom messag state trigger send messag deriv state collect input messag attack process privaci spresso privaci analysi ident provid spresso learn user log formal properti indistinguish properti ident provid model web attack distinguish user log reli parti user log reli parti definit privaci spresso web system consid privaci spresso web system sws defin web attack network attack honest dns server honest forward browser honest reli parti honest parti corrupt honest dns server address resolv ident provid assum dishonest subsum web attack govern ident web attack subsum dishonest forward dns server reli parti server honest reli parti set public sign key verifi ident assert domain regist dns server model cach reli parti discuss order state privaci properti replac honest browser describ web system extend browser call challeng browser browser corrupt parameter domain reli parti assembl http request special domain challeng put send request challeng take domain request challeng request domain alter fail domain challeng list honest dns server denot web system describ sws priv domain reli parti challeng browser system defin privaci spresso note attack process sws priv distinguish sens definit spresso idp privat iff web system sws priv domain reli parti describ sws priv sws priv sws priv sws priv indistinguish note situat honest browser sws priv trigger send http request challeng exampl trigger user enter url locat bar browser locat header determin adversari attack script tell browser follow link creat ifram definit requir stage matter challeng request trigger malici idp challeng replac login request recal challeng request replac honest browser place adversari request request adversari determin figur happen challeng request definit captur strong sens intuit malici idp distinguish user log log analyz privaci spresso theorem spresso enjoy describ privaci definit theorem spresso idp privat full proof provid appendix proof defin equival relat configur sws priv sws priv compris equival state equival event pool wait event state type atom process web system defin state exampl state fwd server ident configur exampl rough speak state subterm attack decrypt wait event distinguish messag result direct indirect challeng request browser messag challeng messag differ way messag differ part attack decrypt equival induct exhaust case distinct start equiva lent configur schedul lead equival configur note sws priv schedul induc singl sws priv determinist action determin schedul honest server script perform determinist action exampl distinguish potenti receiv event fwd receiv messag ident state configur equival definit equival input event equival hold output messag state atom process browser rps harder exampl browser distinguish script browser includ attack script origin script action perform equival configur sws priv sws priv view indistinguish sws priv sws priv schedul lead equival configur spresso idp privat authent spresso spresso satisfi fundament authent properti formal model spresso authent authent analysi consid web system defin network attack finit set browser finit set reli parti finit set ident provid finit set forward browser forward reli parti corrupt network attack network attack subsum web attack act dishonest dns server parti denot web system class web system swsauth defin authent spresso state fundament authent properti sso system satisfi properti adapt inform properti state attack servic honest honest user attack hold deriv current knowledg servic token issu honest honest user browser browser close malici user closecorrupt attack authent honest browser honest own browser ident inject properti clear requir forward honest honest well call web system swsauth secur authent condit satisfi run system refer reader appendix formal definit analyz authent spresso prove theorem theorem swsauth spresso web system defin swsauth secur authent authent properti fulfil spresso web system proof general properti swsauth encrypt commu nicat https honest reli parti honest idp alter network attack base honest reli parti retriev correct public signatur verif key honest idp proceed servic token issu honest request specif form receiv properti general web system properti full version prove properti separ case assum respect properti satisfi lead contradict full proof provid appendix work mention introduct sso system develop spresso privaci respect design implement spresso formal analysi system base express web model work formal treatment secur web applic young disciplin work area base general model incorpor essenti mechan web earli work formal web secur analysi base limit model develop applic scrutini work consid general model web written finit state model checker alloy work akhaw inspir work bansal built express model call webspi proverif tool symbol cryptograph protocol analysi model appli web standard applic kumar present high level alloy model appli saml singl sign web model present extend refin comprehens web model discuss fact model analyz spresso exampl model incorpor precis handl window document ifram cross document messag postmessag includ conclus paper propos privaci respect web base sso system idp track user log system spresso open decentr user log email address spresso support allow seamless conveni integr usual login process sole base standard web featur spresso browser platform devic formal prove spresso enjoy strong authent privaci properti discuss paper numer attack sso system discov attack demon strate design secur sso system trivial secur flaw easili undetect rigor analysi carri mention analysi effort base express model web infrastructur web applic general sso system literatur analysi carri paper independ interest work analyz privaci properti base express web model fact express model general indistinguish privaci definit propos tailor specif web applic will analysi perform paper refer abadi fournet mobil valu name secur communic proceed acm symposium principl program languag popl acm press akhaw barth lam mitchel song formal foundat web secur proceed ieee comput secur foundat symposium csf ieee comput societi armando carbon compagna cu√©llar tobarra formal analysi saml web browser singl sign break saml base singl sign googl app shmatikov editor proceed acm workshop formal method secur engin fmse acm bai lei meng venkatraman saxena sun liu dong authscan automat extract web authent protocol implement proceed annual network distribut system secur symposium ndss internet societi bansal bhargavan delignat lavaud maffei key cloud formal analysi concret attack encrypt web storag basin mitchel editor principl secur trust second intern confer post volum lectur note comput scienc springer bansal bhargavan maffei discov concret attack websit author formal analysi chong editor ieee comput secur foundat symposium csf ieee comput societi blanchet effici cryptograph protocol verifi base prolog rule proceed ieee comput secur foundat workshop csfw ieee comput societi chari jutla roy univers compos secur analysi oauth iacr cryptolog eprint archiv cheval comon lundh delaun trace equival decis negat test determin chen danezi shmatikov editor proceed acm confer comput communic secur ccs acm fett k√ºster schmitz express model web infrastructur definit applic browserid sso system ieee symposium secur privaci ieee comput societi fett k√ºster schmitz analyz browserid sso system primari ident provid express model web technic report arxiv arxiv http fett k√ºster schmitz analyz browserid sso system primari ident provid express model web comput secur esor european symposium comput secur vienna austria septemb lectur note comput scienc springer appear full version http fitzpatrick recordon openid authent dec http spec openid authent html hardt oauth author framework oct http html recommend oct jackson alloy technolog softwar model katoen steven editor tool algorithm construct analysi system intern confer taca volum lectur note comput scienc springer kerschbaum simpl cross site attack prevent third intern confer secur privaci communic network workshop securecomm ieee comput societi kumar lightweight formal approach analyz secur web protocol attack intrus defens intern symposium raid gothenburg sweden septemb proceed volum lectur note comput scienc springer mozilla ident team persona https nitot persona privaci better secur make develop user happi code blog apr https code persona somorovski mayer schwenk kampmann jensen break saml kohno editor proceed usenix secur symposium bellevu usa august usenix associ sovi kohlar schwenk secur analysi openid sicherheit volum lni spresso demo site sourc code https sun beznosov devil implement detail empir analysi oauth sso system danezi gligor editor acm confer comput communic secur ccs acm sun hawkey beznosov systemat break fix openid secur formal analysi semi autom empir evalu practic countermeasur comput secur wang chen wang sign account facebook googl traffic guid secur studi commerci deploy singl sign web servic ieee symposium secur privaci san francisco california usa ieee comput societi wang zhou chen qadeer evan gurevich explic sdks uncov assumpt under secur authent author proceed usenix secur symposium washington usa august usenix associ zhou evan ssoscan autom test web applic singl sign vulner proceed usenix secur symposium san diego usa august usenix associ web model model web infrastructur propos chang addit set wait event replac infinit sequenc wait event sequenc initi infinit number trigger event interleav receiv event output process front sequenc write event term run process step infinit sequenc multi set run state event nonc written superscript subscript atom process replac set output messag sequenc term defin equat theori form time sequenc output process element prepend sequenc wait event introduc global sequenc nonc process output special placehold state output messag placehold replac fresh chosen nonc global set nonc approach appli script run insid browser receiv fresh set nonc time call browser script dedic set nonc input output oper script finish replac fresh placehold browser placehold browser remov set nonc process remov function symbol extractmsg extract sign term signatur function symbol checksig check term sign accur privaci analysi introduc header associ document properti introduc locat document properti script command link href add option avoid send refer header model rel noreferr attribut link dns respons address domain dns request domain realist model communic model detail definit basic concept communic model term messag event signatur term messag consid work union pairwis disjoint set function symbol constant three set pairwis disjoint interpret set ascii string includ empti string interpret set address function symbol public key symmetr encrypt decrypt signatur pub enca deca enc dec sig checksig extractmsg ari sequenc project symbol pii string element specif font exampl httpreq httpresp string denot dom set domain dom denot method set method http request post method equat theori associ signatur figur definit nonc term denot set variabl denot infinit set constant nonc pairwis disjoint defin set term induct usual term ari function symbol term term denot congruenc relat induc theori associ exampl deca enca pub spell error earli http standard practic major browser internet explor support properti deca enca pub dec enc checksig sig pub pii fig equat theori definit ground term messag placehold protomessag denot set term variabl call ground term set messag defin set ground term defin set vprocess variabl call placehold set vprocess call set protomessag messag placehold exampl exampl pub messag typic model privat key pub correspond public key constant nonc messag enca pub interpret messag sequenc constant encrypt public key pub definit normal form term normal form acquir reduc function symbol left equat theori figur term denot normal form definit pattern match pattern term wildcard variabl term match pattern iff acquir pattern replac occurr wildcard arbitrari term instanc wildcard write pattern term write pattern denot term acquir remov subterm match pattern exampl exampl pattern definit variabl replac denot ground term replac occurr definit event protoev event term form interpret receiv address sender address denot set event event call protoev denot denot set sequenc proto event includ empti sequenc atom process system run atom process take current state event input determinist output state set event definit generic atom process system generic atom process tupl set state vprocess input event state map sequenc output event state initi state state sequenc nonc demand system infinit set atom process definit configur configur system tupl state system map atom process current state sequenc wait event infinit event wait deliv infinit sequenc nonc sens term defin earlier definit concaten sequenc term sequenc defin concaten definit subtract sequenc sequenc set sequenc defin sequenc element determinist chosen occur element remov definit process step process step system form ein eout configur ein event process eout sequenc term event exist sequenc term protoev term vprocess sequenc placehold appear order lexicograph sequenc element ein eout eout ein omit superscript subscript arrow intuit process step select process call event list wait event output state output event replac occur placehold fresh nonc remov output event prepend list wait event state process reflect configur definit run system sequenc event sequenc nonc system initi nonc finit sequenc configur infinit sequenc configur finit infinit denot state process will initi run set infinit trigger event form trigger interleav address atom dolev yao process defin atom dolev yao process requir messag state output comput formal deriv current input event state purpos defin deriv messag messag definit deriv term set ground term term deriv placehold exist denot set messag deriv variabl exampl enca pub definit atom dolev yao process atom dolev yao process simpli process tupl atom process event sequenc protoev vprocess hold true dvprocess definit atom attack process atom attack process set sender address atom process event iff dvprocess script process defin script process model client side script technolog javascript script process defin process definit placehold script process vscript denot infinit set variabl script process definit script process script process simpli script relat vscript vscript dvscript script call browser state state limit state script output term repres intern state command interpret browser term variabl browser will replac unus placehold will replac nonc browser process finish effect provid script fresh nonc attack process defin attack script ratt definit attack script attack script ratt output deriv input ratt dvscript web system web infrastructur web applic formal call web system web system infinit set process model web browser web server dns server attack corrupt entiti browser definit web system script tupl compon defin compon denot system set process partit set hon web net honest web attack network attack process web net attack process set sender address web attack web requir set address disjoint set address web attack honest process hon web web attack listen traffic intend process requir web attack sender address own convers network attack listen address restrict spoof address set hon process model web server web browser dns server describ subsect web attack requir spoof sender address set address disjoint honest process web attack second compon finit set script ratt third compon script inject map script assign string represent script final infinit sequenc event infinit number event form trigger initi messag data format provid detail data messag format need formal treatment web model analysi browserid present rest appendix notat definit sequenc notat sequenc set defin write denot sequenc finit set denot term form order element matter chosen arbitrarili definit dictionari term form key uniqu call term element dictionari key write denot set dictionari note empti dictionari equival empti sequenc figur short tation dictionari oper will describ browser atom process dictionari write exist write tract element set fig dictionari oper term refer subterm sequenc integ subterm determin repeat applic project pii integ sequenc call sequenc pointer definit pointer sequenc negat integ write applic pointer term oper appli left pointer consist singl integ omit sequenc brace breviti exampl term pointer subterm posit improv readabl avoid write document will name compon sequenc defin form pointer point correspond subterm origin term defin host protocol origin term write exampl url definit url term form url protocol host path paramet protocol plain http secur https host dom path paramet set valid url url exampl url url algorithm describ url origin definit origin term form host protocol host dom protocol write origin set origin exampl exampl foo https origin domain foo bar http origin domain bar cooki definit cooki term form content content term form secur session httpon secur session httpon write cooki set cooki set cooki name valu defin secur attribut cooki set browser will transfer cooki unencrypt http connect session flag set cooki will delet browser close httpon attribut control javascript access cooki note cooki form describ contain http request respons compon transfer pair form http messag definit http request term form http respons term form httpreq nonc method host path paramet header bodi httpresp nonc status header bodi compon defin nonc serv map respons correspond request method method http method host dom host host header http path string indic request resourc server side status http status code number defin http standard paramet url paramet header request respons header dictionari element term follow ing form origin origin set cooki sequenc cooki cooki note header name valu cooki transfer locat url refer url strict transport secur bodi request respons write httprequest httprespons set http request respons exampl http request respons httpreq post origin foo bar httpresp set cooki sid somescript http request url http origin header bodi foo bar respons httpon cooki sid well string represent somescript script process script somescript element initi state encrypt http messag https request encrypt public key server request ephemer symmetr key chosen client issu request server support encrypt respons symmetr key definit encrypt http request form enca httprequest correspond encrypt http respons form enc httprespons call set encrypt http request respons httpsrequest httpsrespons exampl enca pub enc term encrypt request encrypt public key pub term respons encrypt symmetr symmetr key request dns messag definit dns request term form dnsresolv domain domain dom call set dns request dnsrequest definit dns respons term form dnsresolv domain result domain dom result call set dns respons dnsrespons dns server suppos includ nonc receiv dns request dns respons send parti issu request match request dns server consid flat dns model dns queri answer direct dns server address domain full hierarch dns system recurs dns resolut dns cach model cover attack dns system definit dns server flat dns model model straightforward atom process finit set address initi state encod map domain name address form dns queri answer tabl ignor detail descript browser model inform descript browser model formal model start introduc notat terminolog notat terminolog web browser state defin state web browser defin window document definit window term form nonc document open nonc document document defin open exact document document empti call activ document write window set window write denot activ document insid window exist will refer window nonc window refer document contain window term left activ document view document user button document window term current activ document document forward button window open top level window window term subterm document term case open term nonc definit document term form nonc locat referr script scriptstat scriptinput subwindow activ nonc locat url referr url script scriptstat scriptinput subwindow window activ limit document term form nonc subwindow nonc subwindow window subwindow call subwindow write document set document document term write denot origin document term origin will refer document nonc document refer defin set state web browser note dictionari notat introduc definit definit set state web browser atom process consist term form window secret cooki localstorag sessionstorag keymap sts dnsaddress pendingdn pendingrequest iscorrupt window window secret origin cooki dictionari dom dictionari cooki localstorag origin sessionstorag origin keymap dom sts dom dnsaddress pendingdn pendingrequest iscorrupt fullcorrupt closecorrupt definit window term write childof write childof transit closur descript web browser relat will helper function subwindow doc clean cookiemerg addcooki browser state subwindow denot set window window list activ document recurs subwindow document exclud subwindow inact document subwindow doc denot set pointer activ document set window referenc subwindow definit pointer definit definit browser state denot subwindow minim set pointer satisfi fol low condit window subwindow subwindow activ document window subwindow pointer subwindow browser state set doc pointer activ document minim set subwindow pointer doc subwindow doc denot respect set includ inact document subwindow function clean will determin window document script run document access definit browser state document clean denot term equal inact document remov includ subwindow subterm repres origin document replac limit document nonc subwindow list note origin document level replac correspond limit document function cookiemerg merg sequenc cooki browser oldcooki sequenc exist cooki origin newcooki sequenc cooki output script sequenc merg set cooki algorithm base storag mechan algorithm describ definit sequenc cooki pairwis name oldcooki sequenc cooki newcooki set cookiemerg oldcooki newcooki defin algorithm newcooki remov cooki newcooki remov cooki appear left newcooki set cooki appear oldcooki newcooki pair cooki cold cnew cold oldcooki cnew newcooki add cnew add cold result cookiemerg oldcooki newcooki function addcooki add cooki receiv http respons sequenc cooki contain sequenc oldcooki base algorithm describ simplifi browser model definit sequenc cooki pairwis name oldcooki cooki sequenc addcooki oldcooki defin algorithm oldcooki remov append return function navigablewindow return set window document allow navig close follow definit definit set navigablewindow set subwindow pointer window activ document allow navig set defin minim set subwindow true activ document origin childof subwindow childof top level window ancestor window subwindow childof top level window ancestor window activ document origin activ document subwindow open top level window open allow navig open window descript web browser atom process will describ relat standard http browser defin belong iff determinist algorithm present input termin output recal input event browser state sequenc output protoev browser state placehold nonc notat notat describ chosen determinist set write denot command repeat element variabl current element order element process chosen determinist will write exampl constant dosomethingels variabl string constant term express constant constant set dosomethingels execut placehold place algorithm present placehold generat fresh nonc describ communic model definit figur list placehold placehold usag algorithm window nonc algorithm http request nonc algorithm lookup key pend http request entri algorithm http request nonc multipl line algorithm subwindow nonc algorithm http request nonc algorithm document nonc algorithm lookup key pend dns entri algorithm window nonc algorithm replac placehold script process output fig list placehold browser algorithm describ main browser algorithm defin function function descript function read global input variabl variabl local variabl argument function getnavigablewindow call browser determin window navig script window window refer navig open link window refer nonc window getnavigablewindow return pointer select window term window string _blank window creat pointer window return window nonc refer window term refer window pointer window term return long window navig current document defin navigablewindow case return script navig window algorithm determin window navig function getnavigablewindow window noreferr window _blank open window _blank noreferr window window pointer element return navigablewindow nonc window return return function function take window refer input return pointer window check activ document window origin creat window algorithm determin origin window function getwindow window subwindow nonc window return return return function function pend request specif window pend request pend dns request remov request window refer algorithm cancel pend request window function cancelnav remov req key pendingrequest req key remov messag protocol pendingdn messag protocol return function function take http request messag input add cooki origin header messag creat dns request hostnam request store request pendingdn dns resolut finish normal http request refer window refer xhrs refer form document nonc document document refer nonc nonc chosen script initi request protocol origin origin header http request algorithm prepar header dns resolut save messag function send refer messag protocol origin referr sts protocol cooki cooki protocol cooki cooki origin origin origin referr refer referr pendingdn refer messag protocol dnsaddress dnsresolv host function function runscript perform script execut step script document window script document state chosen relat defin script script document state save command script issu interpret algorithm execut script function runscript tree clean cooki cooki tlw window tlw top level window sessionstorag sessionstorag localstorag localstorag secret secret script tree cooki localstorag sessionstorag secret state cooki localstorag sessionstorag command state cooki localstorag sessionstorag command cooki cookiemerg cooki cooki localstorag localstorag sessionstorag sessionstorag state switch command case href url hrefwindow noreferr getnavigablewindow hrefwindow noreferr req httpreq noreferr referr referr cancelnav nonc send nonc req referr case ifram url window getwindow window req httpreq referr send req referr case form url method data hrefwindow method post getnavigablewindow hrefwindow work draft allow delet method form remov http org diff chang method bodi paramet data origin bodi data paramet origin req httpreq method paramet bodi referr cancelnav nonc send nonc req origin referr case setscript window script getwindow window script case setscriptst window scriptstat getwindow window scriptstat case xmlhttprequest url method data xhrrefer method connect trace track xhrrefer method head data origin origin req httpreq method data referr send xhrrefer req origin referr case window getnavigablewindow window document document document activ cancelnav nonc case forward window getnavigablewindow window document document document document document activ cancelnav nonc navig window forward button trigger reload document real browser chose refresh document case assum complet state view document restor reload trigger determinist point main algorithm case close window getnavigablewindow window remov sequenc case postmessag window messag origin subwindow nonc window document origin document origin document document postmessag messag case function function processrespons respons process http respons respons receiv respons request request earlier refer window document refer explan algorithm protocol function save cooki contain respons browser state check redirect request locat header case function creat document normal request deliv content respons respect receiv xhr respons algorithm process http respons function processrespons respons refer request protocol set cooki set cooki cooki cooki addcooki cooki strict transport secur protocol sts sts refer referr refer referr locat url locat method bodi rfc httpbis current draft status obsolet rfc post delet request answer status code rewritten request histor reason detail specif clear status code browser follow specif regard focus model standard demand user confirm redirect safe method post assum user general confirm redirect exampl request redirect origin request contain bodi bodi preserv http allow payload messag http method trace method detail omit browser will send bodi payload method semant data place origin origin origin protocol origin head method bodi subwindow refer redirect xhrs req httpreq method bodi send refer req origin referr subwindow refer normal respons locat url protocol script scriptstat locat referr script scriptstat remov document subwindow refer process xhr respons xmlhttprequest refer function main algorithm main algorithm browser relat receiv messag input well algorithm main algorithm input pendingrequest collect incom messag trigger special trigger messag switch switch script subwindow activedocu runscript switch creat request window window protocol host dom path paramet req httpreq host path paramet send req protocol switch reload document subwindow url req httpreq referr cancelnav send req referr fullcorrupt request corrupt browser iscorrupt fullcorrupt closecorrupt close browser secret window pendingdn pendingrequest sessionstorag cooki cooki cooki iscorrupt closecorrupt refer request key pendingrequest dec key httpresp encrypt http respons dec key nonc remov refer request key pendingrequest processrespons refer request httpresp refer request pendingrequest nonc remov refer request pendingrequest processrespons refer request dnsrespons success dns respons host refer messag protocol protocol pendingrequest pendingrequest refer messag messag enca messag keymap pendingrequest pendingrequest refer messag pendingdn pendingdn messag formal model spresso full detail formal model spresso analysi authent privaci properti will restrict generic model suit set respect analysi model spresso web system sens appendix call web system sws script spresso web system form describ outlin system hon web net consist web attack process web network attack process net finit set fwd forward finit set web browser finit set web server reli parti finit set idp web server ident provid finit set dns dns server hon idp fwd dns detail process provid figur set script respect string represent defin map script set trigger event appendix script ratt att_script script_rp script_rp script_rp_redir script_rp_redir script_idp script_idp script_fwd script_fwd fig list script respect string represent outlin sws will defin process sws address domain name secret detail script defin detail appendix address domain name set web attack web network attack net reli parti ident provid idp forward fwd dns server dns browser finit set address addr denot correspond assign process address set dom finit set domain forward fwd reli parti ident provid idp web attack web network attack net browser dns server dns domain addr dom denot assign atom process set dom key secret set nonc partit set infinit sequenc infinit set kssl infinit set ksign finit set secret infinit sequenc kssl finit ksign finit secret finit set nonc process creat set kssl key will ssl encrypt sslkey dom kssl inject map assign privat key domain set ksign key will idp sign signkey idp ksign inject map assign privat key ident provid set secret set password secret browser share ident provid ident indentit email address consist user domain model defin definit ident email address term form domain domain dom finit set ident idi denot set domain domain dom govern process domain belong formal defin map governor domain dom domain governor will idp attack secretofid secret denot biject map assign secret ident ownerofsecret secret denot map assign secret browser own secret defin map ownerofid ownerofsecret secretofid assign ident browser own ident ident belong browser tag ident assert definit tag term form enc domain nonc nonc symmetr key definit ident assert term form sig tag email address ident domain nonc call encrypt ident assert eia addit symmmetr encrypt form enc nonc corrupt rps idp fwds corrupt receiv messag corrupt start collect incom messag state trigger send messag deriv state collect input messag attack process idp forward honest state corrupt readi defin process well script detail process overview provid overview process process dns server initi state public key privat key respect domain defin addr hon web web attack web web attack appendix address send listen network attack net network attack appendix address send listen browser web browser defin appendix initi state secret own store origin respect idp appendix detail reli parti reli parti web server distinct path serv web script_rp startlogin accept post request issu fresh nonc detail redir accept request valid login session token serv script_rp_redir redirect browser idp login accept post request login data login process script_rp run browser check data data deem valid issu servic token detail list token state intuit client token servic specif ident record token idp rps corrupt ident provid idp web server outlin user authent idp credenti idp track state user session authent user receiv idp receiv special messag corrupt idp corrupt definit corrupt browser idp start send messag deriv state forward fwds web server state serv script script_fwd appendix detail dns dns dns dns server defin appendix state alloc domain name address ssl key map defin atom process detail defin common data structur hold map domain name public ssl key atom process defin sslkeysp sslkey dom web attack web web attack initi state attdom sslkey signkey attdom sequenc domain correspond privat key own sslkey sequenc domain correspond public key signkey sequenc public sign key idp parti attack dns server network attack mention network attack model network attack appendix allow listen spoof address defin ina initi state attdom sslkey signkey attdom sequenc domain correspond privat key own attack sslkey sequenc domain correspond public key signkey sequenc public sign key idp browser web browser defin appendix addr address defin init state idb ownerofid set idb idb set domain secretdomainsb idb set domain own ident initi state defin key map map domain public ssl key map sslkey dns address addr list secret entri secretdomainsb secretofid idb idb sts empti reli parti reli parti web server model atom process address addr initi state domain privat key associ domain dns server address domain forward full state addit set servic token login session identifi issu accept https request manag kind session login session login phase user servic session call session identifi servic session servic token servic session allow user servic ultim goal login flow establish servic session typic flow client will receiv http request path case return script script_rp user enter email address will receiv https post xmlhttprequest path startlogin request expect email address user enter reli parti contact email provid retriev spresso support document extract public key idp select nonc rpnonc iakey tagkey loginsessiontoken creat tag symmetr encryp tion domain rpnonc tagkey return browser loginsessiontoken tagkey domain forward fwddomain document browser open login dialog receiv third request case request path redir paramet loginsessiontoken session redirect user idp redirect serv hide refer string request idp send script script_rp_redir initi script state defin script redirect user url login dialog https domain email address well spresso login final receiv request login flow post request encrypt loginsessiontoken conclud login login session decrypt check signatur tag email address fwd domain success return servic token store state receiv corrupt messag corrupt act attack provid formal definit atom process mention defin addr defin set state initi state definit login session record term form email rpnonc iakey tag email rpnonc iakey tag definit state term form dnsaddress fwddomain keymap sslkey pendingdn pendingrequest loginsess servicetoken wkcach corrupt dnsaddress fwddomain dom keymap sslkey sslkeysr pendingdn pendingrequest servicetoken loginsess dictionari login session record wkcach corrupt initi state state servicetoken loginsess wkcach corrupt keymap keymap browser relat appendix describ relat determinist algorithm algorithm send respons startlogin xmlhttprequest function sendstartloginrespons email indomain rpnonc tagkey iakey loginsessiontoken tag enc indomain rpnonc tagkey loginsess loginsessiontoken email rpnonc iakey tag bodi tagkey tagkey loginsessiontoken loginsessiontoken fwddomain fwddomain enc httpresp bodi function algorithm relat reli parti input corrupt corrupt corrupt corrupt refer request key pendingrequest dec key httpresp encrypt http respons dec key nonc remov refer request key pendingrequest email indomain email indomain refer wkcach bodi sendstartloginrespons email indomain dnsrespons success dns respons host refer messag pendingrequest pendingrequest refer messag messag enca messag keymap pendingdn pendingdn messag handl http request mdec indomain mdec deca indomain method path paramet header bodi httpreq method indomain path paramet header bodi mdec path serv enc httpresp script_rp initstaterp initi state defin script_rp path startlogin method post serv start login request bodi domain domain sendstartloginrespons bodi indomain messag httpreq domain well spresso info pendingdn bodi indomain messag dnsaddress dnsresolv domain path redir method serv redirect script loginsess loginsess bodi loginsessiontoken loginsess domain param email tag iakey fwddomain fwddomain url url domain well spresso login param enc httpresp script_rp_redir url path login method post serv login request header origin indomain bodi loginsessiontoken loginsess loginsess bodi loginsessiontoken loginsess loginsess loginsess bodi loginsessiontoken dec bodi eia fwddomain checksig wkcach signkey servicetokennonc servicetoken servicetokennonc servicetoken servicetoken servicetoken enc httpresp servicetoken ident provid ident provid idp web server model atom process address addr initi state list domain privat ssl key list user identit privat key sign full state list nonc activ session idp react three type request provid well document machin readabl document verif key document serv request path well spresso info second request path well spresso login idp serv login dialog script script_idp initi state script idp encod browser log idp issu xsrf token browser rps login dialog will eventu send xmlhttprequest path loginxhr retriev type request idp answer serv respons request idp check user proper authent creat send browser formal descript will defin initi state formal definit relat defin initi state will term repres user databas idp will call term userseti databas defin secret valid ident encod map ident secret exampl secret valid identit secret valid ident userseti userseti defin userseti userseti secretofid idi definit state idp term form sslkey user signkey session corrupt sslkey sslkeysi user userseti signkey key idp sign session corrupt initi state state form sslkeysi userseti signkey relat defin behavior idp defin algorithm relat idp input corrupt corrupt corrupt corrupt mdec indomain mdec deca indomain method path paramet header bodi httpreq method indomain path paramet header bodi mdec path well spresso info serv support document wkdoc signkey pub signkey enc httpresp wkdoc path well spresso login serv login dialog sessionid header cooki sessionid email session sessionid enc httpresp script_idp start email initi scriptstat script_idp defin path sign method post serv sign request sessionid header cooki sessionid loggedina session sessionid bodi email loggedina bodi password userset bodi email sig bodi tag bodi email bodi fwddomain signkey sessionid session sessionid bodi email setcooki set cooki sessionid sessionid enc httpresp setcooki forward defin fwds formal atom process fwd ifwd zfwd rfwd mention defin ifwd addr fwd set state zfwd term form sslkey corrupt sslkey corrupt initi state fwd privat key domain corrupt state fwd sslkeysfwd fwd respond https request script_fwd initi state empti relat rfwd fwds describ relat determinist algorithm algorithm relat fwd rfwd input corrupt corrupt mdec indomain mdec deca indomain method path paramet header bodi httpreq method indomain path paramet header bodi mdec enc httpresp script_fwd dns server outlin dns server model generic dns server present appendix static state set alloc domain name address dns server corrupt spresso script mention appendix set web system sws script consist script ratt script_rp script_idp script_fwd string represent att_script script_rp script_idp script_fwd defin script script script_rp script_idp script_fwd defin formal introduc notat helper function notat helper function formal descript script abbrevi url write urldpath describ url term url path order simplifi descript script helper function chooseinput state document term scriptinput record input document xhrs postmessag append script document activ will typic pick input messag sequenc scriptinput record input process purpos function chooseinput scriptinput pattern call choos messag scriptinput match pattern return algorithm choos unhandl input messag script function chooseinput scriptinput pattern min scriptinput pattern return return pii scriptinput function parentwindow determin nonc referenc activ document parent window browser function parentwindow tree docnonc take term tree part clean tree browser window script document nonc docnonc nonc referenc current document script run input output nonc referenc activ document window direct subwindow window document referenc docnonc window case script run document top level window activ document parentwindow return docnonc subwindow function take term tree document nonc docnonc input function docnonc refer document contain tree subwindow tree docnonc return docnonc origin script scriptstat scriptinput subwindow activ denot subterm tree correspond document refer docnonc subwindow tree docnonc return subwindow auxwindow function take term tree document nonc docnonc input window term tree window document identifi docnonc open select determinist return activ nonc window activ document return docnonc openerwindow function take term tree document nonc docnonc input return window nonc open window window document identifi docnonc recal nonc identifi open window store insid window term document nonc docnonc tree tree return getwindow function take term tree document nonc docnonc input return nonc window docnonc getorigin extract origin document function getorigin tree docnonc function search document identifi docnonc clean tree tree window document return origin document document nonc docnonc tree tree return getparamet work exact getorigin return paramet reli parti script_rp defin appendix script relat take input term output term appendix trigger script document trigger action formal algorithm input term provid browser current intern state script call scriptstat addit browser state script access input script xhrs postmessag window browser expect output term specif form appendix algorithm output term intern scriptstat describ structur intern scriptstat script script_rp definit scriptstat script_rp term form loginsessiontoken refxhr tagkey fwddomain loginsessiontoken refxhr tagkey fwddomain initi scriptstat initstaterp script_rp start relat script_rp formal describ relat determinist algorithm script explain appendix algorithm formal specif input term script obtain browser clean tree window document tree nonc current document docnonc scriptstat scriptstat defin definit sequenc input scriptinput handl input dictionari cooki access cooki domain localstorag localstorag belong origin secret secret origin set nonc fresh nonc input script return scriptstat set cooki cooki localstorag localstorag term command denot command browser algorithm relat script_rp input tree docnonc scriptstat scriptinput cooki localstorag sessionstorag secret scriptstat command origin getorigin tree docnonc switch case start email refxhr command xmlhttprequest startlogin post email refxhr expectstartloginrespons case expectstartloginrespons pattern xmlhttprequest refxhr input chooseinput scriptinput pattern input loginsessiontoken input loginsessiontoken tagkey input tagkey fwddomain input fwddomain command href url redir loginsessiontoken loginsessiontoken _blank expectfwdreadi case expectfwdreadi fwdwindownonc subwindow tree auxwindow tree docnonc nonc pattern postmessag fwdwindownonc fwddomain readi input chooseinput scriptinput pattern input command postmessag fwdwindownonc tagkey tagkey fwddomain expecteia case expecteia fwdwindownonc subwindow tree auxwindow tree docnonc nonc pattern postmessag fwdwindownonc fwddomain eia input chooseinput scriptinput pattern input eia input refxhr bodi eia eia loginsessiontoken loginsessiontoken command xmlhttprequest login post bodi refxhr expectservicetoken cooki localstorag sessionstorag command reli parti redirect script_rp_redir simpl script load regular redirect login dialog window actual login dialog idpdoc load idp expect url browser redirect initi state algorithm relat script_rp_redir input tree docnonc scriptstat scriptinput cooki localstorag sessionstorag secret command href scriptstat scriptstat cooki localstorag sessionstorag command login dialog script script_idp script model content login dialog definit scriptstat script_idp term form email email call scriptstat initi scriptstat script_idp iff start formal relat script_idp script process algorithm relat script_idp input tree docnonc scriptstat scriptinput cooki localstorag sessionstorag secret scriptstat command origin getorigin tree docnonc switch case start email getparamet tree docnonc email tag getparamet tree docnonc tag fwddomain getparamet tree docnonc fwddomain bodi email email password secret tag tag fwddomain fwddomain command xmlhttprequest sign post bodi expectia case expectia pattern xmlhttprequest input chooseinput scriptinput pattern input iakey getparamet tree docnonc iakey fwddomain getparamet tree docnonc fwddomain tag getparamet tree docnonc tag eia enc input iakey url url fwddomain tag tag eia eia command ifram url _self cooki localstorag sessionstorag command forward script script_fwd definit scriptstat script_fwd term form call initi scriptstat script_fwd iff start formal relat script_rp_index script process algorithm relat script_fwd input tree docnonc scriptstat scriptinput cooki localstorag sessionstorag secret scriptstat command target openerwindow tree parentwindow tree docnonc switch case start command postmessag target readi expecttagkey case expecttagkey pattern postmessag target tagkey input chooseinput scriptinput pattern input tagkey input tag getparamet tree docnonc tag eia getparamet tree docnonc eia rporigin dec tag tagkey command postmessag target eia eia rporigin cooki localstorag sessionstorag command formal secur properti authent state secur properti spresso defin spresso web system authent analysi web system base spresso web system consid network attack subsum web attack network attack definit swsauth script spresso web system call swsauth spresso web system authent analysi iff network attack process attack attack process net attack web dns server dns server assum dishonest subsum attack initi state browser inw dns address addr attack initi state reli parti dns address addr attack secur properti spresso formal defin note servic token record creat result https post request refer request correspond definit swsauth spresso web system authent analysi swsauth secur swsauth state honest fwddomain domain fwd honest servic token form record servicetoken condit satisfi deriv attack knowledg attack browser own fulli corrupt iscorrupt fullcorrupt governor honest idp request correspond honest own proof theorem prove theorem general properti swsauth properti swsauth swsauth script web system write state web system definit atom process messag emit process step form set event address definit term deriv contain term set process process step deriv knowledg definit set process leak term process step set process exist messag emit deriv contain process step omit defin set singl element omit set notat definit process creat messag point deriv contain messag emit process step earlier process step deriv contain messag emit process definit browser accept messag respons request browser decrypt messag https messag call function processrespons pass messag request algorithm definit fashion accept messag respons request decrypt messag rps accept https messag bodi wkcach state algorithm call definit atom process term state deriv term knowledg definit script initi request browser trigger script algorithm compon command output script relat href ifram form xmlhttprequest browser issu request step result swsauth state lemma lemma process step swsauth honest reli parti emit https request form enca req pub req http request nonc symmetr key privat key process initi state privat key iii leak statement true state swsauth parti decrypt req process step leak process step leak symmetr key corrupt host header req domain assign public key pub keymap keymap initi state accept respons process step honest leak symmetr key prior creat https respons https request nonc http request req atom process atom process proof condit initi leak knowledg nonc deriv network output parti deriv req assum leak process step prior leak key fulli corrupt lead contradict honest definit key fresh nonc key store pendingrequest pendingrequest extract handl receiv messag check leak parti prove definit rps algorithm host header contain http request rps algorithm encrypt key request req chosen host header messag chosen keymap state chang prove https respons accept respons encrypt nonc store pendingrequest state store fresh chosen nonc nonc purpos send specif request alter delet read browser check incom messag nonc leak parti prior leak leak honest send respons encrypt symmetr encrypt key outgo https request encrypt key encrypt respons match https request pendingrequest prove uunionsq lemma honest reli parti host wkdoc wkcach hold wkdoc signkey pub signkey dom host dom host honest idp proof honest wkcach popul algorithm bodi receiv messag written wkcach respons https messag line assembl request request path well spresso info origin request store pendingrequest domain origin request encrypt final condit lemma dom honest idp lemma appli creat https respons alter parti algorithm honest idp respond request path well spresso info construct document wkdoc send document bodi https respons document form signkey pub signkey term signkey defin definit signkey chang algorithm pair form signkey pub signkey dom store wkcach appli pair wkcach prove lemma uunionsq definit servic token defin servic token respons https respons contain bodi messag servic token request https request trigger servic token respons lemma swsauth state honest servicetoken properti hold exist exact exist process step form event address servic token respons exist exact exist process step form event address servic token request process step servic token request https messag form enca httpreq nreq post login pub sslkey dom term nreq dictionari eia enc sig tag fwddomain ksign iakey tag enc nrp tagkey loginsess loginsessiontoken email tag loginsess loginsessiontoken tag iakey loginsess loginsessiontoken iakey nonc nrp ksign governor honest idp ksign signkey governor proof servic token nonc servic token servicetoken contain respons assembl line algorithm fresh chosen store ident servicetoken servicetoken servic token respons servic token store servicetoken alter servic token nonc exact servic token respons algorithm easi servic token respons trigger exact request basic form encrypt https request host header usag correct encrypt key enforc line path compon check login method compon check post valu eia tag iakey check line term check sign signatur key store wkcach index domain email address lemma domain email address signatur key signkey dom dom governor sign signatur key honest idp govern email address content signatur includ tag check uunionsq properti state properti defin definit swsauth spresso web system authent analysi swsauth secur respect properti swsauth state honest fwddomain domain fwd honest servic token form record servicetoken deriv attack knowledg attack browser own fulli corrupt iscorrupt fullcorrupt governor honest idp spresso web system secur regard properti assum exist spresso web system secur will lead contrad spresso web system secur regard properti detail assum exist spresso web system swsauth swsauth state honest fwddomain domain fwd honest servic token form record servicetoken deriv attack knowledg attack browser own fulli corrupt governor honest idp proceed proof contradict condit lemma fulfil servic token request servic token respons exist form lemma governor honest idp leak sign key algorithm sign subterm sig tag fwddomain signkey creat idp honest idp creat signatur algorithm lemma assumpt browser issu request mcert trigger idp creat sign term request mcert https public https key proof consid case request mcert user log ident browser session cooki carri nonc session identitiy mark log compar algorithm request carri request bodi password match ident secretofid secret initi depend corrupt status case honest secret parti https defin definit browser close corrupt parti honest case close corrupt discard secret secret https idp send parti browser send request mcert case second user log ident browser session refer log session session retriev log case appli provid proper secret session form cooki set secur https deriv attack prior work httpon access script browser send cooki idp send session parti session leak attack browser atom process send request mcert case case request https public key browser intend request encrypt request password case cooki case browser correct encrypt key domain defin swsauth uunionsq request mcert https alter read parti easi point mcert honest knowledg secret lemma browser request mcert trigger script_idp load origin dom proof dom origin access secret secretofid ident defin appendix general properti defin definit ident provid appendix properti send script script_idp script trigger request secret uunionsq lemma browser script script_idp receiv respons request mcert script point browser honest proof definit browser corrupt browser discard pend request state close corrupt ssl key decrypt respons close corrupt receiv respons rest general properti defin uunionsq script script_idp receiv respons lemma will assum browser honest case browser close corrupt pend https request decrypt key discard state proof lemma contradict assumpt requir arriv lemma receiv script_idp forward fwd honest earlier point document script_fwd load fwd https proof browser close corrupt case discard store window structur precis script state insid window structur browser remov browser close corrupt honest case script_idp defin algorithm open ifram fwddomain https request script_idp forward domain store variabl fwddomain algo rithm variabl set line earlier paramet current document actual paramet fwddomain paramet chang browser definit set document load paramet fwd domain sign fwd origin fwddomain domain forward assumpt fwddomain origin honest fwd contact https general properti defin appli definit forward algorithm respond script_fwd forward fwd script script_fwd uunionsq lemma script script_fwd forward script script_rp load origin proof script script_idp run honest browser forward encrypt tag script_fwd definit idp script algorithm clear tag forward encrypt sign idp script algorithm decrypt tag receiv match key send postmessag encrypt domain contain tag protocol origin https document deliv receiv postmessag script_rp script receiv postmessag uunionsq lemma document eia https proof definit script_rp algorithm conjunct fact document load origin lemma sign transfer browser honest forward attack corrupt parti list parti leak corrupt parti attack creat record messag creat knowledg eia definit forward creat messag option left send request parti read respons general secur properti will content respons algorithm leak attack corrupt parti contrad assumpt assum attack swsauth secur sens properti properti state properti defin definit swsauth spresso web system swsauth secur respect properti swsauth state honest fwddomain domain fwd honest servic token form record servicetoken request correspond honest own appli lemma call request correspond servic token request respons lemma refer state swsauth process lemma request script_rp load origin domain proof request xsrf protect algorithm check presenc origin header request initi document origin honest browser origin header pass test origin header browser definit script script_rp script honest parti send respons send request uunionsq lemma request nonc loginsessiontoken loginsess loginsessiontoken email own ownerofid proof lemma request script_rp algorithm defin script_rp bodi request assembl script send request path login session token state loginsessiontoken state initi set chang respons start login xhr issu request respons coupl refxhr track state script select ident ident browser own definit browser appendix ident start login xhr receiv request https messag alter read attack ultim function sendstartloginrespons algorithm call case function call algorithm well cach entri host contain email address sendstartloginrespons call email address contain bodi email address bodi store http nonc https encryp tion key data subterm pendingdn state move pendingrequest final sendstartloginrespons call will case sendstartloginrespons call loginsessiontoken chosen dictionari loginsess loginsessiontoken email address data store loginsessiontoken respons encrypt symmetr key contain request case list retriev request relationship email address preserv case receiv decrypt respons email address request explain script_rp take loginsessiontoken respons bodi store state request start login xhr describ place entri dictionari loginsess alter remov servic token request correspond loginsessiontoken process loginsessiontoken leak parti loginsess loginsessiontoken email select script own uunionsq lemma algorithm servic token assembl chosen loginsess loginsessiontoken email own indistinguish web system definit web system command schedul call term web system command simpli mand form cmdswitch cmdwindow url compon defin cmdswitch cmdwindow vscript variabl vscript set placehold script processess definit vprocess variabl vprocess set placehold definit url url url set valid url definit call finit sequenc web system command web system schedul simpli schedul definit induc process step script web system eout process step definit cmdswitch cmdwindow url web system command process step induc iff lexicograph order process eout web attack process corrupt browser iscorrupt eout eout eout honest browser iscorrupt trigger browser relat behav eout cmdswitch browser relat choos switch algorithm algorithm cmdwindow window tree state window script attack script browser determinist execut script window algorithm browser relat choos output script window variabl determinist chosen algorithm cmdswitch browser relat choos switch algorithm protocol host domain path paramet algorithm url url protocol host path paramet cmdswitch browser relat choos switch algorithm algorithm cmdwindow window tree state window browser start reload document window write corollari case command cmdswitch cmdwindow url induc process step configur web system process step induc appli refer exist process command schedul trigger messag deliv browser cmdswitch cmdwindow subwindow command choos window browser exist process step induc definit induc script web system finit web system schedul infinit sequenc pairwis disjoint nonc finit system induc nonc iff induc process step denot set run induc infinit sequenc pairwis disjoint nonc defin notion indistinguish web system defin notion static equival term model definit notion static equival abadi fournet definit static equival term set variabl static equival written iff term variabl hold true definit web system distinguish attack script web system partit hon web net definit attack attack process web net call script attack web system distinguish attack attack definit indistinguish web system distinguish attack call indistinguish schedul iff schedul exist call indistinguish iff indististinguish schedul formal proof privaci will describ precis model privaci defin equival relat configur will proof privaci formal model spresso privaci analysi definit challeng browser domain process call challeng browser iff defin exact browser describ appendix except state con tain properti challeng initi term algorithm extend check messag address domain challeng call challeng domain address domain messag address domain challeng chang address domain challeng set record messag address challeng definit determinist process call process determinist iff relat partial function call script rscript determinist iff relat rscript partial function definit spresso web system privaci analysi sws script spresso web system hon web net hon idp fwd dns describ appendix fwd fwd dns dns honest reli parti fwd honest forward dns honest dns server attack web web attack domain challeng browser hon fwd dns web web net net work attack hon web net script_idp script call sws priv script attack spresso web system privaci analysi iff domain fwddomain domain assign fwd domain domain assign domain assign configur forward fwd state fwddomain set fwddomain browser own exact email address email address govern attack honest parti hon corrupt ignor corrupt messag ident provid assum dishonest subsum web attack govern ident initi state browser initi state reli parti dns address addr dns wkcach initi state equal public key domain regist dns server reli parti public key verifi spresso ident assert domain system fetch idp parti spresso web system privaci analysi web attack browser determinist process script process attack script determinist easi spresso web system privaci analysi configur command induc process step note infinit sequenc nonc schedul induc command induc process step configur will defin privaci properti spresso definit idp privaci sws sws priv script sws sws priv script spresso web system privaci analysi requir attack requir web system paramet challeng browser sws priv idp privat iff sws sws priv indistinguish definit equival configur sws script attack sws priv script attack spresso web system privaci analysi configur sws configur sws priv definit proto tag call term form enc variabl placehold domain nonc proto tag definit term equival proto tag finit set proto tag term call term equival set proto tag iff exist term write finit set term term equival set proto tag iff lexicograph order element form element form write definit equival http request encrypt http request finit set proto tag call equival set proto tag iff subterm equal except host origin refer header request domain replac http bodi http bodi term equival eia enc sig enc fwddomain origin http header http messag receiv messag iii dictionari key loginsessiontoken exist loginsessiontoken encrypt http request encrypt http request key encrypt request correct key write definit extract entri login session dictionari finit set proto tag domain call equival iff construct proto tag remov entri identifi dictionari key hold denot set remov entri write definit proto tag state spresso web system privaci analysi nonc call login session token proto tag written loginsessiontoken iff loginsess definit equival state set proto tag set nonc enc call equival iff condit met fwd fwd dns dns equal subterm pendingdn loginsess servicetoken equal subterm pendingdn loginsess servicetoken set term loginsess loginsess loginsess entri subterm pendingdn hold true domain dns server subterm pendingrequest subterm wkcach equal public key domain regist dns server web net dns fwd attack attack loginsessiontoken subterm equal subterm challeng pendingdn pendingrequest window challeng challeng challeng challeng pendingdn pendingdn pii pendingdn pii pendingdn iii nonc term form nonc nonc host host nonc nonc subterm pendingrequest pendingrequest pii pendingrequest pii pendingrequest iii nonc term form nonc nonc host host nonc addr addr nonc subterm pendingrequest pendingrequest pendingdn pendingdn deriv term parti window equal window except subterm locat referr scriptstat scriptinput document term point doc doc script_rp script_rp_redir iii fwddomain script_fwd script_rp term equival host equal term equival host equal subterm xmlhttprequest postmessag fwddomain readi postmessag fwddomain eia subterm contain subterm term equival host equal term equival host equal subterm fwddomain postmessag tagkey script_rp_redir case pii pii pii pii pii pii pii pii pii pii vii fwddomain subterm cooki localstorag sessionstorag sts main entri subterm definit equival event set proto tag set login session token set nonc enc call equival iff condit satisfi condit hold true http messag http request http respons http nonc http messag contain dns request dns dns request dns dns request parti dns address dns domain unknown dns server dns respons dns dns request dns respons dns dns request http request http request request unencrypt encrypt content encrypt nonc http respons http respons http messag contain contain http bodi bodi http bodi bodi nonc dictionari key loginsessiontoken exist loginsessiontoken exist subterm messag messag messag messag exist http respons http respons bodi http messag form tagkey encrypt http respons bodi fwd script_fwd http respons bodi reli parti locat strict transport secur set cooki header string repres script script_rp script_rp_redir dns respons dns domain unknown dns server unencrypt http respons messag attack definit equival configur call equival iff exist set proto tag set nonc equival equival loginsessiontoken privaci proof theorem spresso web system privaci analysi idp privat sws priv script attack spresso web system privaci analysi prove theorem spresso web system sws sws priv indi tinguish definit sws sws priv defin sws priv script attack sws script attack challeng browser requir denot process sws priv definit dns denot honest dns server fwd denot honest forward domain fwddomain denot honest reli parti domain denot honest reli parti domain definit indistinguish sws sws priv indistin guishabl schedul note induc web system schedul determinist proceed schedul iff induc sws exist sws priv sws priv sws configur equival view attack static equival lemma equival configur attack attack proof equival attack attack condit equival enc web net attack key tag contain view easi view static equival uunionsq sws sws induct length lemma equival indistinguish view attack hold initi configur sws sws lemma configur induc process step equival hold true lemma initi configur sws sws equival proof exist set proto tag set nonc equival equival loginsessiontoken condit true parti clear state equal condit definit fulfil initi configur equival uunionsq lemma equival configur sws sws priv cmdswitch cmdwindow url web system command induc process step configur case configur induc equival proof set proto tag set nonc equival hold loginsessiontoken enc induc process step messag select definit denot messag differenti receiv messag note equival induc process step configur analyz condit state corollari number wait event configur set process browser exchang address process share address system refer process run process step induc deliv deliv addit window structur browser cmdwindow refer window exist configur case induc process step system denot induc process step case fwd case case definit appli case case appli fwd forward relat algorithm line execut process step easi event event case definit case hold trivial true event static address http nonc https key contain input messag state fwd tag extract output messag case definit hold true output event construct exact respect input event case appli output event equival chang state equival nonc chosen case dns case case definit appli dns note appli analog case case easi second case easi dns server output empti event process step third case case definit appli equival three case chang state case equival nonc chosen case consid case happen ignor process step distinct case https request dns respons impli dns respons dns process reli parti dns respons drop state chang state reli parti fulfil condit definit rps queri domain unknown dns fulfil condit definit dns respons dns domain unknown dns contradict dns respons http respons impli condit definit reli parti drop http respons state chang messag proper encrypt http request impli reli parti drop messag process step state chang note reli parti send unencrypt http respons type http request accept algorithm path path startlogin start login path redir redirect idp path login login case definit appli case case case will analyz http request list separ definit case case impli output event case definit appli impli output event http nonc contain http nonc incom http request contain output http respons reus http nonc nonc http respons path case output event produc condit definit hold true appli remain condit trivial fulfil equival chang state equival nonc chosen path startlogin domain email address messag bodi equival regist dns server wkcach public key domain contain wkcach unknown contain wkcach regist dns server case dns request dns term request match case definit construct address string nonc term deriv input event condit definit appli input event condit appli output event equival state equal subterm pendingdn equal subterm pendingdn subterm pendingdn entri domain unknown dns server condit definit hold equival exact nonc chosen process step domain email address valid regist wkcach sendstartloginrespons call process step tag construct exact http respons element bodi string condit hold true tag creat run alter analog equival subterm loginsess state extend exact equival process step exact nonc chosen path redir note contain defint equival note reli parti receiv encrypt http request path redir stop algorithm empti output emit http respons state reli parti chang case process step case appli bodyi bodi https request case appli iff loginsess bodyi loginsessiontoken line algorithm condit definit loginsess construct loginsess remov entri dictionari key loginsessiontoken key dictionari entri dictionari key loginsessiontoken entri case appli process step case exact output emit state chang nonc chosen case element respons bodi script_rp_redir trivial equival configur path login case handl analog previous case except addit check algorithm second check simultan succeed fail case check easi eia eia structur structur match expect structur check process step fail accept ident assert tag email address forward domain equal loginsess loginsessiontoken loginsess loginsessiontoken accept process step accept empti messag accept nonc chosen exact process step definit case http request http request case impli note condit definit hold reason previous case respons address address condit definit fulfil output event case definit appli impli output event http nonc contain http nonc incom http request contain output http respons reus http nonc nonc http respons path case output event produc result equival definit case chang state equival nonc chosen path startlogin email address input event equival domain reli parti email address domain unknown case analogu wkcach sendstartloginrespons call process step tag con struct domain process step http respons creat denot http respons generat generat enc httpresp enc httpresp tagkey loginsessiontoken fwddomain fwddomain tagkey loginsessiontoken fwddomain fwddomain equal set enc exact nonc chosen process step receiv messag browser hold loginsessiontoken exist loginsessiontoken condit definit hold equival subterm loginsess extend exact subterm loginsess equival mention process step exact nonc chosen path redir definit equival login session token definit equival algorithm stop process step empti output emit http respons process step condit definit loginsess loginsess denot http respons generat generat enc httpresp enc httpresp script_rp_redir url well spresso login script_rp_redir url well spresso login deriv exact key loginsessiontoken key contain output output event fulfil condit definit state chang nonc chosen equival configur path login case handl analog previous case except addit check algorithm check origin header second check ident assert check fail fail hold true second check accept ident assert email address equal loginsess loginsessiontoken loginsess loginsessiontoken ident assert valid sign correct tag ident assert valid accept process step accept empti messag accept nonc chosen exact process step case case analogu case note case definit occur definit case case distinct type messag browser receiv dns respons input event condit definit condit appli dns request respons nonc event equival domain set proto tag condi tion definit nonc entri dictionari pendingdn browser entri key nonc browser continu process incom dns respons state chang output event algorithm note resolv address contain dns respons address condit definit protocol store http request browser choos nonc https request case address dns respons address address address address case pend request respect browser amend fulfil condit fulfil condit essenti http request case condit definit fulfil case output messag fulfil condit condit definit contain dns respons condit definit address dns respons differ respons condit definit request prepar subterm condit definit hold true contain respons condit definit contain pend http request output event equival equival configur equival http respons case clear http respons nonc match nonc pendingrequest messag tag tag condit definit nonc pendingrequest nonc browser browser output chang state distinguish case browser refer store http nonc window refer case request normal http request refer pair document nonc xhr refer chosen script request xhr condit definit easi case refer browser case distinguish case http nonc case case definit appli locat set cooki strict transport secur header respons respons equal proto tag case definit browser encrypt key store pendingrequest expect sender observ browser accept decrypt messag call function processrespons browser state chang output event case equival trivial note expect sender case match precis sender messag compar case definit processrespons chang browser cooki perform cooki respons sts subterm chang redirect perform locat header document creat browser form locat referr script scriptstat locat url protocol host path paramet script scriptstat protocol path paramet request subterm equal term equival proto tag case definit host referr state exchang domain note request will correct form pars document browser browser empti output state chang browser attach newli creat document window tree check condit definit satisfi incom messag encrypt messag case definit messag script script_rp script_rp_redir case definit check condit definit scriptstat initi equal subterm http nonc host document script input empti refer construct refer header request equal case host sum equival preserv equival preserv output event generat exact number nonc chosen http nonc case case definit http nonc sender encrypt key origin request pend request browser equal equival proto tag subterm tag input observ browser accept decrypt messag call function processrespons browser state chang output event case equival trivial note expect sender case match precis sender messag equal set cooki header respons entri cooki browser creat term equival complianc requir equival hold true strict transport secur header locat header request generat store pend dns request dns request http request method bodi origin header origin request equival proto tag origin header amend host protocol origin request event subterm transfer initi scriptstat request generat locat header subterm assum domain locat header challeng request term equival browser dns request generat conform condit definit http request store pend dns request browser clear case condit equival condit equival satisfi number nonc chosen altogeth equival domain challeng browser start request challeng case browser behav domain request host header exchang alpha equival hold configur nonc chosen http request dns request generat case conform condit definit equival equival number nonc chosen equival locat header document construct case nonc scriptstat initi equal script input empti refer construct refer header request equal case proto tag sum equival preserv case well equival preserv output event generat exact number nonc chosen case respons respons xhr refer tupel refer docnonc xhrref distinguish case http nonc case case definit appli locat set cooki strict transport secur header respons respons equal proto tag case definit browser encrypt key store pendingrequest expect sender observ browser accept decrypt messag call function processrespons browser state chang output event case equival trivial note expect sender case match precis sender messag compar case definit processrespons chang browser cooki perform cooki respons sts subterm chang redirect perform locat header input construct document identifi docnonc note document exist browser browser output state chang input event subterm http nonc host document construct scriptinput subterm hold true key scriptinput term document xmlhttprequest xhrref http bodi xhrref easi scriptinput term document term equival proto tag satisfi equival browser state output event generat nonc chosen equival configur http nonc case case definit http nonc sender encrypt key origin request pend request browser equal equival proto tag observ browser accept decrypt messag call function processrespons browser state chang output event case equival trivial note expect sender case match precis sender messag equal set cooki header respons entri cooki browser creat term equival complianc requir equival hold true strict transport secur header locat header browser state chang output event case equival trivial xhr redirect browser locat header input construct document identifi docnonc note document exist browser scriptinput document xmlhttprequest xhrref http bodi subterm easi scriptinput term document term equival proto tag satisfi equival browser state output event generat nonc chosen equival configur trigger distinguish valu cmdswitch trigger script case script window index cmdwindow trigger pointer window note window exist iff exist distinguish case cover state window document script_rp script main distinct script intern state name term equival proto tag state tag illeg state case script will produc output chang state distinguish valu start case script choos nonc process step creat xhr address origin case equal path static string startlogin script save fresh chosen nonc referenc xhr static scriptstat note contain state state case command term equival proto tag browser emit dns request term equival append xhr pendingdn equival state equival event equival configur case prepar http request equival pendingdn state set nonc browser choos browser emit dns request fulfil condit definit equival state request pendingdn state fulfil condit equival event equival configur expectstartloginrespons case script retriev result xhr scriptinput match refer contain scriptstat condit definit xhrs scriptinput term equival scriptstat term equival browser script empti command continu retriev xhr url construct exact https origin origin document distinguish case origin equal origin case subterm contain scriptinput subterm contain construct url second case subterm contain scriptinput url command browser prepar request request store pendingdn state store prepar http request pendingdn browser choos nonc construct set condit definit hold true case written written case contain output event generat http request creat event request output event browser dns request equal dns request match condit definit equival equival exact number nonc chosen configur equival expectfwdreadi case script retriev result postmessag scriptinput match postmessag term equival window structur equal browser postmessag retriev scriptinput browser script construct postmessag exact window browser requir receiv origin fwddomain postmessag origin equival violat contain postmessag constraint concern script input origin equival equival exact number nonc chosen configur equival expecteia case script retriev result postmessag scriptinput match postmessag term equival window structur equal browser postmessag retriev scriptinput browser script choos nonc process step creat xhr address origin case equal path static string login script save fresh chosen nonc referenc xhr static scriptstat case command term equival proto tag browser emit dns request term equival append xhr pendingdn equival state equival event equival configur case note bodi prepar http request encrypt ident assert eia enc sig enc fwddomain receiv messag determin origin header set prepar http request equival prepar request pendingdn state set nonc browser choos browser emit dns request fulfil condit definit case store construct output event state chang equival state request pendingdn state fulfil condit equival event equival configur script_rp script_rp_redir case script output command browser command navig window url save scriptstat term equival proto tag browser http request generat store pendingdn origin refer header term equival domain http request equival state browser equival case challeng condit definit fulfil output messag fulfil condit clear contain state generat dns request http request process step exact number nonc chosen equival fwddomain script_fwd case state tag illeg state case script will produc output chang state equival window structur target variabl algorithm script_fwd run point window script run distinguish valu start case postmessag exact content window trivial equival state case output event generat nonc equival hold state expecttagkey case chang state occur postmessag term dictionari key tagkey exact window scriptinput condit definit scriptinput postmessag exist browser appli browser challeng challeng state tag contain postmessag term equival proto tag theta domain insid tag process step addit eia contain url paramet locat script term equival proto tag theta postmessag eia deliv receiv equal browser addit contain eia locat case browser state equival output event produc equival exact number nonc chosen fact nonc chosen configur equival fwddomain assumt script case attack script ratt subsum script observ view input term browser term equival proto tag script run equival definit state definit window tree structur process step window term equal document subterm origin document subterm term equival subwindow subterm origin document limit document equal subwindow limit document window document nonc subterm cooki localstorag sessionstorag scriptstat scriptinput term equival subterm secret equal subterm key tag view term contain output command script scriptstat input script term equival placehold vscript key tag output script scriptstat cooki localstorag sessionstorag command term equival proto tag number nonc replac output term process step note element command output equal browser string browser will ignor command process step analog input subterm distinguish command script output paramet command term equival empti invalid command case browser output messag state chang equival trivial href url hrefwindow noreferr browser call getnavigablewindow deter mine window document will load synchron window structur browser result will process step includ creat window nonc http request assembl url refer header request current locat term equival send function host url challeng will replac case equival hold nonc generat http request hold domain sts subterm state request will rewritten https cooki domain request note step appli request definit entri domain sts cooki request equival pend dns request fulfil condit definit dns request creat condit condit definit number nonc chosen process step equival hold ifram url window case complet parallel case form url method data hrefwindow case parallel case origin header properti refer header case setscript window script case document manipul process step note origin document attack document manipul output event generat nonc chosen equival trivial setscriptst window scriptstat case parallel case xmlhttprequest url method data xhrrefer case parallel case addit origin header case addit refer paramet transfer pendingdn insid browser xhrrefer equival note refer nonc equal process step browser stop process step window forward window close window script output mand process step browser will manipul exact output event generat nonc chosen postmessag window messag origin case term messag term equival scriptinput term origin term will document process step term document exampl origin target document browser domain case equival defin scriptinput preserv script_rp sender origin fwddomain navig url case window open browser document load url state browser chang domain url challeng case point empti window creat append window subterm browser subterm chang exact http request creat append pendingdn generat request process step differ host iff domain challeng case domain replac equival hold nonc generat http request case condit definit satisfi request generat dns request equival condit condit definit process step three nonc chosen equival reload document exist document retriev origin locat definit equival document reload locat term equival term equival domain note case request construct locat referr properti document reload case note domain challeng document reload dns request issu browser equival entri pend dns messag equival number nonc chosen run equival case nonc http request pend dns entri equival number nonc chosen equival messag discard browser chang state output event case attack case definit appli input event input event term equival proto tag impli messag deliv attack process process step attack process case definit case case definit attack decrypt tag knowledg attack state variabl vprocess output term fix term variabl vprocess subterm contain condit definit easi output event equival contain output event encrypt key tag nonc state attack process step consist input event output event state event equival proto tag equival configur uunionsq prove theorem 